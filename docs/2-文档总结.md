对细节的问题到此为止，当前我的目标只是分析这个初始需求。你现在是一位细致严谨的研发技术文档工程师。请根据我们已经确认的需求，使用中文生成一份完整、全面的开发文档，用于指导AI工具进行代码开发。
这份开发文档应该包含以下内容（尽可能使用文字描述，避免使用代码，除非是非常必要的核心逻辑）：

1. **功能概述：** 简要描述该功能的目标和作用。
2. **详细功能描述：**
- **UI 展示：** 描述用户界面上的元素、布局和显示规则。例如，需要展示哪些信息？如何组织这些信息？是否有特定的样式要求？
- **交互流程：** 详细描述用户如何与界面进行交互，以及每个交互步骤触发的操作和结果。例如，用户点击某个按钮会发生什么？输入框是否有校验规则？
- **逻辑功能：** 描述后台需要处理的业务逻辑。例如，当用户提交表单时，需要进行哪些数据处理？如何存储数据？（对于不确定的技术细节，务必使用小括号备注“不确定”）
1. **数据模型（如果适用）：** 描述涉及的数据结构和字段名称。
2. **不确定的技术细节：** 列出在需求分析阶段尚未确定的技术细节，并注明“(不确定)”。
这份开发文档需要足够详细，以便AI工具能够理解并生成相应的代码。请尽可能地包含所有必要的细节，确保文档的完整性和可执行性。
记住：只回复开发文档内容即可，不需要任何解释或额外的说明。

好的，请查阅以下根据我们已确认的需求，并结合您提供的 `README.md` 和系统优化文档中的**初始需求相关信息**，生成的开发文档：

## AI 驱动的 UI 自动化测试平台 - 开发文档

**版本:** 1.1
**日期:** 2025-04-27

**1. 功能概述**

本系统旨在构建一个基于计算机视觉（明确使用 YOLO 模型，具体模型文件 `best.pt`）与 Airtest 集成的 UI 自动化测试框架，初期重点面向移动游戏。该框架利用深度学习模型实现跨平台、跨分辨率的 UI 元素识别，旨在提高测试稳定性并降低传统图像识别自动化的维护成本。平台提供一个基于 Web 的界面（Django 后端 + Vue 前端）用于管理测试资产（录制的 JSON 脚本、探索生成的路径）、配置和执行测试任务、监控执行过程，并通过包含截图、日志和设备状态的详细报告及路径可视化图表来分析结果。系统支持三种核心测试模式：固定场景脚本回放（目标 1）、UI 自动化深度遍历（目标 2）以及固定场景路径全量遍历（目标 3）。

**2. 详细功能描述**

**2.1 UI 展示 (Web 界面 - Django+Vue)**

- **整体布局:**
    - 基于 Django (后端) 和 Vue (前端) 构建的 Web 应用。
    - 清晰的导航结构，主要包含三大功能模块入口：目标 1 (脚本管理与回放)、目标 2 (深度遍历)、目标 3 (路径全遍历)。
    - 包含用户登录/认证界面（采用 Django 标准认证机制）。
    - 提供集中的后台任务管理视图，展示所有（运行中、已完成、排队中）的任务状态。
    - 设有系统通知区域（例如，显示 WebSocket 连接状态、后台任务完成/失败通知摘要等）。
    - 包含管理后台区域，用于特定管理功能。
- **目标 1: 录制脚本管理与回放**
    - **文件/文件夹浏览器视图:**
        - 以层级结构（类似桌面文件管理器）展示用户创建的文件夹和 JSON 格式的测试脚本文件。
        - 提供菜单栏操作按钮支持：创建文件夹、重命名文件/文件夹、移动文件/文件夹。
        - 列表展示选定文件夹内容，包含列信息：名称、类型（文件夹/脚本）、最后修改日期、最后修改者、锁定状态（显示为 "[用户名] 锁定" 或 "未锁定"）。
        - 支持按“应用/游戏”、“版本”（若适用）、“作者”（最后修改者）进行筛选。
        - 支持按“名称”、“修改日期”进行排序。
        - 提供顶部搜索框，仅用于按“文件名”或“文件夹名”进行搜索。
    - **脚本编辑器视图 (双击 JSON 脚本文件打开):**
        - **锁定机制:** 打开文件时检查其锁定状态。若已被其他用户锁定，则显示只读视图，并提示“文件当前正由 [用户名] 编辑中”。若未锁定，则自动为当前用户锁定该文件。
        - **布局:** 上下分栏视图：
            - 上方面板: 按顺序展示与 JSON 中各步骤关联的截图缩略图。点击缩略图可放大查看。
            - 下方面板: 使用集成 Monaco Editor 或类似富文本编辑器组件，展示和编辑 JSON 脚本内容。
        - **编辑器特性:**
            - JSON 语法高亮。
            - **双向同步:** 点击上方面板的图片缩略图，下方面板自动滚动并高亮对应的 JSON 步骤结构体；反之亦然。*（注意：在撤销/重做、添加/删除步骤等结构性更改时，上方的图片序列显示为空白或保持不变，暂不要求实时同步更新图片序列，此功能后期改进）。*
            - **步骤类型视觉区分:** 在 JSON 编辑器中，对 `step`, `Priority`, `uncertainty` 类型的步骤进行视觉区分（例如，`uncertainty` 步骤使用黄色字体）。
            - **编辑功能:** 允许手动编辑 JSON 文本。提供结构化编辑方式：修改 `important` 值（1-10 范围）、在 `step`/`Priority`/`uncertainty` 之间切换步骤类型、添加新步骤（需要关联截图）、删除步骤、拖拽或通过按钮调整步骤在列表中的顺序。
            - **实时校验:** 在用户编辑或尝试保存时进行校验：JSON 语法是否合法；同一 `steps` 列表内 `Priority` 值是否唯一；`important` 值是否在 1-10 之间；基本的 `class` 名称格式检查（非严格字典校验）；整体 JSON 是否符合预定义的 Schema。在界面上清晰地提示错误或警告信息。
            - **撤销/重做:** 集成一个成熟的前端 JavaScript 库来管理撤销/重做状态。必须支持基础文本编辑，并按以下优先级顺序支持结构性操作的撤销/重做：1. 调整步骤顺序，2. 调整 `important` 值，3. 更改步骤类型，4. 添加/删除整个步骤结构体（JSON 块）。撤销/重做历史需要持久化存储（见逻辑功能和数据模型部分）。
            - **保存按钮:** 点击后，提示用户输入本次更改的说明（类似 Git commit message）。校验通过后，将更改（以差异 Diff 形式）保存到数据库，创建新的版本记录（每个文件最多保留最近 20 个版本，自动删除最旧的）。保存成功后，用户继续持有该文件的锁。用户关闭编辑器标签页或浏览器时，自动释放锁。
    - **执行/报告视图:**
        - 回放任务结束后，生成并展示基于 Airtest HTML 报告模板定制的报告。
        - 定制内容：
            - 保留标准的成功（绿色对勾）和失败（红色叉）图标。
            - 新增“警告”图标（黄色感叹号）：用于标记因未找到目标而被跳过的 `uncertainty` 步骤，以及交互执行失败但非阻塞性的 `uncertainty` 步骤。
            - 成功执行交互的 `uncertainty` 步骤显示为“成功”。
            - 交互失败且阻塞流程的 `uncertainty` 步骤显示为“失败”。
        - 交互性：点击报告中的任何步骤（尤其是失败或警告步骤），应能弹出或在侧边栏显示详细信息：错误消息文本、相关的日志片段、该步骤执行时的截图、关联的 AI 模型置信度（若适用）、该步骤执行时刻的设备状态快照（包含当时的设备截图、当前 Activity 名称、屏幕上所有被识别元素的列表及其 class/位置/置信度、网络状态、设备方向等）。
- **目标 2: UI 自动化深度遍历**
    - **配置页面:**
        - 下拉选择目标“应用/游戏”。
        - 定义“起始锚点”（用于标识探索开始的界面，可以通过截图、关键元素组合等方式定义 - (不确定)）。
        - 设置探索参数：
            - `exploration_mode`: 下拉选择（'balanced', 'wide', 'deep' - 默认 'balanced'）。影响探索策略。(不确定具体策略细节)
            - `new_screen_priority_boost`: 输入框（数值，用于调整新界面探索优先级，高级设置）。
        - 设置终止条件（可配置多个，任一满足即停止）：最大持续时间（分钟/小时）、最大操作步骤数、状态稳定（持续 X 分钟/步骤未发现新界面/元素 - (不确定)）、覆盖率阈值（达到独特界面/元素数量的百分比 - (不确定)）。
    - **结果视图:**
        - **路径可视化:** 使用图形库（如 D3.js, G6 等）以树状、流程图状或力导向图形式展示探索到的 UI 状态转换路径，支持横向或纵向展开。
            - 节点: 代表唯一的 UI 界面状态（通过关键元素集合或界面截图 HASH 识别）。节点上显示界面缩略图，点击可查看大图。
            - 边 (转换): 代表从一个界面状态到另一个状态的操作（通常是点击某个 `class` 元素）。显示为带箭头的连线。
            - 主路径与分支: 自动识别或用户可标记主要流程路径。其他分支路径（包括处理 `uncertainty` 步骤的路径）从主路径节点引出，显示在其上方或下方。`uncertainty` 步骤本身及其处理操作也表示为图上的节点和边，可使用特殊样式（如虚线、黄色）区分。连续的 `uncertainty` 步骤形成串联的分支路径。
            - **交互:** 支持缩放、平移画布；展开/折叠节点以控制复杂度；支持框选一部分节点/路径；支持在节点或边上添加/查看文本备注（需持久化存储）。支持将选中的完整路径导出为目标 1 的 JSON 格式脚本。
- **目标 3: 固定场景路径全遍历**
    - **配置页面:**
        - 选择“应用/游戏”。
        - 定义“起始锚点”和至少一个“结束锚点”（同样通过视觉或标识符定义）。
        - 设置最大循环检测次数（例如，默认 3 次），避免无限循环。
    - **结果视图:**
        - 以列表形式展示所有从起始锚点到任意一个结束锚点之间找到的**唯一**路径。路径唯一性**仅**根据其包含的所有**非 `uncertainty`** 步骤的 `class` 值序列来判断。
        - 列表每行展示一条路径，包含信息：唯一路径 ID、路径长度（步骤数）、首次发现该路径的任务 ID。
        - 支持按路径长度排序。
        - 提供操作：选择一条或多条路径，将其导出为目标 1 的 JSON 格式脚本。
- **通用 UI 元素:**
    - **任务管理视图:**
        - 表格展示所有已提交的任务（包括排队中、运行中、已完成、已失败、依赖失败、已取消状态）。
        - 列信息：任务 ID、任务类型（目标 1/2/3）、关联的脚本/配置名称、当前状态、提交者、提交时间、开始/结束时间。
        - 对于运行中的任务，显示实时进度条，并能展示当前执行阶段名称（如“设备连接中”、“脚本解析中”、“步骤 N 执行中”、“报告生成中”等）。
        - 提供操作按钮：取消运行中的任务、查看已完成任务的报告、查看任务日志（点击后弹出模态框，实时滚动显示任务的关键输出日志）。
    - **管理后台:**
        - 提供管理员专属页面。
        - `important` 计算配置：允许管理员查看和通过输入框修改每个应用的 `important` 计算权重因子（历史数据权重 vs 当前版本数据权重）；提供按钮手动触发平均值重置（可选择清除特定日期范围或版本之前的数据）。
        - 文件锁定管理：列出当前所有被锁定的文件，显示锁定者和锁定时间。提供“强制解锁”按钮，点击后要求管理员输入解锁原因（必填），并弹出确认对话框提示风险。操作会被记录。
        - 解锁日志查看：提供界面查看所有强制解锁的操作记录（谁、何时、对哪个文件、解锁原因）。
    - **系统通知:**
        - 使用 WebSocket 实现与后端的实时通信。在界面顶部或状态栏显示 WebSocket 的连接状态（连接中、已连接、已断开、尝试重连中）。
        - 后台任务（目标 1/2/3）成功结束或执行失败时，系统应主动通过集成的邮件和企业微信机器人（在指定群内）发送通知。
        - 对于长时间运行的任务（例如，运行超过 0.5 小时），系统应发送“仍在运行”的进度更新通知，并且之后每隔 0.5 小时发送一次，直至任务结束。
        - 所有通知内容应包含任务基本信息，失败通知还应包含错误摘要、错误截图（若有），并提供指向 Web 界面上对应任务详情或报告页面的直接链接。

**2.2 交互流程**

- **用户登录:** 用户通过登录页面输入凭据进行身份验证。
- **文件/文件夹管理:** 用户在文件浏览器视图中，通过点击文件夹进入，或使用顶部菜单栏按钮进行创建文件夹、重命名文件/文件夹、移动文件/文件夹（选中目标后点击移动，弹出树状选择器选择目标位置；若目标位置存在同名项，禁止操作并提示用户）等操作。
- **脚本编辑与保存:** 用户双击 JSON 文件。系统检查并处理锁定。用户在编辑器中进行修改。点击“保存”按钮，弹出对话框要求输入“更改说明”。确认后，后端进行校验、保存版本、更新元数据，前端编辑器保持打开状态，锁继续由该用户持有。
- **任务提交:** 用户在目标 1/2/3 的配置页面完成设置（选择脚本、填写参数、选择目标设备 - (设备选择机制不确定)），点击“开始任务/提交任务”按钮。
- **任务执行与监控:** 后端接收任务请求，进行校验（如目标 2/3 检查依赖的登录脚本是否存在且可用）。任务进入队列，状态在任务管理视图中更新。任务调度到设备上执行。执行过程中，进度条和阶段名称在任务管理视图中实时更新。用户可随时点击“查看日志”按钮，在弹出的模态框中查看实时滚动的日志输出。
- **只读模式与实时高亮:** 当一个脚本正在被执行（因此被锁定）时，其他用户打开该脚本会进入只读模式。前端与后端建立 WebSocket 连接。后端执行引擎每执行一个步骤，就通过 WebSocket 向所有监听该脚本的前端发送当前执行步骤的索引或标识。前端接收到消息后，在只读编辑器界面上高亮对应的 JSON 步骤结构体和上方的截图缩略图。
- **WebSocket 连接处理:** 若 WebSocket 连接意外断开，前端应自动尝试重连 5 次，每次间隔 5 秒。若 5 次后仍无法恢复连接，应在界面上明确通知用户“与服务器的实时连接已断开，无法实时更新状态”，并停止尝试重连。
- **结果查看与分析:** 任务完成后，用户可在任务管理视图点击“查看报告”链接，或直接导航到目标 2/3 的结果视图。在报告中，用户可点击步骤查看详细信息。在路径可视化视图中，用户可进行缩放、平移、展开/折叠、添加备注等交互操作。
- **路径导出:** 在目标 2 或目标 3 的结果视图中，用户选择一条或多条路径，点击“导出为 Target 1 脚本”按钮。后端处理后，在用户指定的文件浏览器位置生成对应的、符合目标 1 格式的 JSON 脚本文件。
- **管理员操作:** 管理员登录后访问管理后台，可进行强制解锁（需填写原因并确认风险）、调整 `important` 计算参数等操作。
- **冲突处理:** 用户尝试编辑已被他人锁定的文件时，收到明确提示，并以只读模式打开。用户尝试移动文件/文件夹到已存在同名项的位置时，操作被禁止，并提示用户。
- **编辑器缓存:** 用户在编辑器中未点击“保存”的修改内容缓存在前端（Vue 状态管理或浏览器 Local Storage - (不确定具体前端缓存策略)）以及 Redis 中。若浏览器崩溃或用户未保存强行关闭，未保存的修改可能丢失，这是允许的。点击“保存”后，数据才持久化到 MySQL，同时 Redis 中的相关缓存会被更新或清除（见逻辑功能部分）。

**2.3 逻辑功能 (后端 - Django)**

- **核心执行引擎:**
    - 加载并使用预训练的 YOLO 模型 (`best.pt`) 对设备屏幕截图进行对象检测，返回识别到的 UI 元素列表（包含 `class`, `confidence`, `position`）。
    - 封装 Airtest API，根据脚本指令（如点击特定 `class` 的元素中心点、输入文本、滑动、按键等）向连接的设备发送控制命令。
    - 管理通过 ADB（初期可能依赖 USB，未来考虑无线 ADB）连接的设备列表及状态。
    - 维护任务队列，调度任务到可用设备上执行。
- **目标 1 脚本回放逻辑:**
    - 解析输入的目标 1 JSON 脚本。
    - 按顺序执行 `steps` 列表中的每个步骤：
        - `step`: 查找具有指定 `class` 的元素。找到则执行预设操作。找不到或执行失败则进入错误处理流程。
        - `Priority`: 在当前屏幕上查找所有在 `priorities` 列表中定义的 `class` 元素。选择 `priority` 值最小（优先级最高）且存在的元素进行操作。若存在多个优先级相同的元素，则选择第一个找到的。若找不到任何 `priorities` 中的元素或执行失败，进入错误处理。
        - `uncertainty`: 此类步骤在任何给定屏幕状态下拥有最高执行优先级。首先查找具有指定 `class` 的元素。若**找不到**，则记录为“警告”（Warning），并**跳过**该 `uncertainty` 步骤，继续执行后续步骤。若**找到**，则尝试执行预设交互。若交互执行**失败**，判断该失败是否阻塞流程（基于预定义规则或步骤属性 - (不确定)），若不阻塞，则记录为“警告”并继续；若阻塞，则进入错误处理流程。
    - **`uncertainty` 多目标特殊处理:** **仅当**初始屏幕扫描识别到**多个 (≥2 个) 潜在的 `uncertainty` 目标同时存在时**，才触发相对耗时的视觉遮挡分析，尝试确定哪个是视觉上最顶层的。若分析成功确定最顶层目标，则对其进行操作。若分析失败或无法唯一确定最顶层目标，则执行预设的回退策略（例如，尝试点击系统返回键，或点击屏幕非 UI 元素区域），尝试最多 3 次。若回退后仍无法消除 `uncertainty` 状态（即它们仍然存在），则视为阻塞性错误，进入错误处理。如果只识别到一个或零个 `uncertainty` 目标，则跳过此遮挡分析。
    - **通用错误处理流程 (适用于 `step`, `Priority` 失败及阻塞性 `uncertainty` 失败):** 尝试重试机制：首先尝试回溯到上一个成功步骤的状态（如果记录了的话）并重试当前失败的操作，最多重试 3 次。若简单重试无效，则尝试重启被测应用，并执行预定义的导航步骤回到逻辑起点（目标 1: 脚本起始；目标 2/3: 定义的起始锚点）。若重启应用或导航回起点也失败，则终止当前任务，标记为“失败”。
    - **报告数据生成:** 在任务执行过程中或结束后，整理详细的步骤数据，用于生成定制化的 HTML 报告。包括每一步的操作详情、执行结果（成功/失败/警告）、时间戳、关联截图路径、关键日志片段、AI 模型置信度、设备状态快照等。
- **目标 2 深度遍历逻辑:**
    - 从配置的“起始锚点”开始。
    - 维护一个内存中的状态图（或使用数据库存储），记录已访问的 UI 界面状态（节点）以及导致状态转换的操作（边）。状态唯一性通过界面关键元素 HASH 或截图 HASH 判断 (不确定)。
    - 循环执行探索，直到满足任一终止条件：
        - 获取当前屏幕状态（截图，识别元素）。
        - 识别当前界面上所有可交互的元素。
        - 根据 `exploration_mode` 策略，结合状态图信息（避免重复访问、优先新界面等，利用 `new_screen_priority_boost` 权重），选择下一个要执行的操作（通常是点击某个元素）。
        - 执行选定的操作。
        - 记录新的状态和转换到状态图中。
        - 遇到 `uncertainty` 元素时，按上述 `uncertainty` 处理逻辑执行。
        - 遇到错误时，执行通用错误处理流程。
    - 任务成功结束后，触发 `important` 相关计算的更新（见下文）。
- **目标 3 全路径遍历逻辑:**
    - 使用图搜索算法（如 BFS 或 DFS 的变种 - (不确定)）在 UI 状态空间中查找从“起始锚点”到所有指定“结束锚点”的路径。
    - 在搜索过程中，记录路径。路径的唯一性严格按照其包含的**非 `uncertainty` 步骤的 `class` 序列**来定义。
    - 实施循环检测机制，当检测到访问同一状态超过配置的最大循环次数时，停止探索该分支。
    - 存储所有找到的、符合唯一性定义的有效路径。
    - 遇到 `uncertainty` 元素时，按其处理逻辑执行，其操作也记录在路径中，但不影响路径唯一性判断。
    - 遇到错误时，执行通用错误处理流程。
    - 任务成功结束后，触发 `important` 相关计算的更新。
- **路径导出逻辑 (目标 2/3 -> 目标 1):**
    - 接收来自目标 2 或 3 的路径数据（状态和操作序列）。
    - 将序列化的操作转换为目标 1 JSON 脚本中的 `steps` 列表。
    - 根据规则自动标记步骤类型：将识别为系统级弹窗（例如 `class` 以 `system-` 开头）的交互标记为 `uncertainty`；其他交互默认为 `step`。（可能需要更复杂的规则来识别 `uncertainty` - (不确定)）。
    - 为路径中 `class` 名称以 `navigation-` 开头的步骤自动赋予初始 `important` 值，默认为 10。
    - 生成符合目标 1 脚本格式的完整 JSON 文件。
- **`important` 计算与更新逻辑:**
    - **触发条件:** 每个目标 2（深度遍历）或目标 3（全量遍历）任务成功结束后自动触发，针对该任务所属的应用/游戏。
    - **启动阈值:** 对于新接入的应用/游戏，系统会统计其已存储的唯一路径（基于非 `uncertainty` 的 `class` 序列，存储在 `ExplorationPaths` 表中）数量。在累计达到 100 条之前，`important` 的自动计算和升级功能是**禁用**的。
    - **平均值计算 (达到阈值后):** 采用**增量更新**方式计算该应用的全局平均探索频率（`AvgFrequency`，衡量特定导航步骤被执行的频率）和平均分支数（`AvgBranching`，衡量特定导航节点引出的不同路径数量）。更新公式使用**加权平均**：`Avg_updated = (Avg_old * N_old * W_history + Avg_new * k * W_current) / (N_old * W_history + k * W_current)`，其中 `Avg_old` 和 `N_old` 是历史平均值和数据点数，`Avg_new` 和 `k` 是本次任务产生的新数据（例如，新路径对频率/分支的贡献），`W_history` 和 `W_current` 是管理员设定的权重因子（默认均为 1）。需确保此更新过程的原子性（例如使用数据库事务或锁）。
    - **`important` 值更新:** 在全局平均值更新后，系统遍历该应用下所有脚本中 `class` 以 `navigation-` 开头的步骤。比较该步骤自身的历史平均频率/分支数与新计算出的全局平均值。如果步骤的指标显著高于全局平均值，则自动提升其 `important` 等级（降低数值）。具体逻辑：若指标 >= 全局平均值，则 `important` 设为 5；之后，指标每比全局平均值高出 10%，`important` 值减 1，最低减至 1。用户手动设置的 `important` 值具有更高优先级，不会被自动计算覆盖，除非手动值大于自动计算值。
- **数据存储 (MySQL):**
    - 使用 MySQL 存储所有持久化数据，包括用户信息、应用设置、脚本/路径资产、版本历史、任务信息、报告数据、探索路径、`important` 权重和统计数据、解锁日志、编辑器撤销/重做状态等。（具体见数据模型）。
    - 对于可能增长迅速的表，如 `Reports`, `ReportSteps`, `ExplorationPaths`, 考虑实施基于时间（如按月）的数据库分区策略。
    - 为常用查询字段（如外键、状态、时间戳、名称等）建立数据库索引。
- **API 层 (Django REST Framework):**
    - 构建 RESTful API 接口，供 Vue 前端调用，以获取数据、触发操作（如保存脚本、提交任务、强制解锁等）、获取任务状态和日志等。
- **实时通信 (WebSockets):**
    - 使用 Django Channels 或类似技术实现 WebSocket 服务，用于后端向前端推送实时信息，主要是任务执行过程中的当前步骤高亮指令，以及任务状态更新通知。处理 WebSocket 的连接建立、消息收发和断开逻辑。
- **版本控制与锁定:**
    - 在数据库层面实现文件锁定逻辑（记录锁定者、时间戳）。
    - 实现强制解锁功能，记录解锁操作日志（包含管理员、时间、目标文件、原因）。
    - 脚本保存时，使用 `diff-match-patch` 或类似库计算新旧版本 JSON 文本内容的差异（diff），仅存储差异以节省空间（首个版本存储全文）。最多保留每个文件最近 20 个版本记录，超过时自动删除最旧的版本。版本记录关联保存时间、操作者、更改说明。版本差异存储**仅针对 JSON 文本内容**，不追踪关联图片的变化。
- **通知服务:**
    - 实现发送邮件（通过配置好的 SMTP 服务器）和向企业微信群（通过机器人 Webhook URL）发送消息的功能。根据任务的最终状态（成功/失败）和长时间运行状态（超过阈值及后续周期性提醒）触发相应的通知。通知内容包含任务关键信息和指向 Web 界面的链接。
- **认证与授权:**
    - 使用 Django 内建的认证系统处理用户登录和会话管理。定义至少两种用户角色：普通用户和管理员，管理员拥有额外权限（如访问管理后台、强制解锁、配置 `important` 参数等）。暂不考虑文件夹级别的权限控制。
- **缓存 (Redis):**
    - 使用 Redis 缓存用户在编辑器中未保存的编辑状态（包括当前文本内容和最近 N 步的撤销/重做操作历史）。缓存键应包含用户 ID 和文件 ID。
    - 缓存有效期策略：8 小时内无任何针对该文件的编辑相关操作（触发缓存更新的交互），则缓存自动失效；或者绝对时间超过 24 小时，缓存也失效。
    - 当用户点击“保存”按钮成功将数据持久化到 MySQL 后，应**清除** Redis 中关于该文件此次编辑会话的撤销/重做历史缓存，但可以更新（或保留）当前文件状态的缓存作为新的起点。

**3. 数据模型 (关键表及字段)**

- **`Users` (用户):** (使用 Django 内建 User 模型)
- **`AppSettings` (应用设置):**
    - `id` (主键), `app_name` (应用名称, unique)。
- **`Folders` (文件夹):**
    - `id` (主键), `name` (文件夹名称), `parent_folder_id` (外键->Folders, 可为空, 实现层级结构), `app_id` (外键->AppSettings, 可为空，表示顶级文件夹属于哪个应用)。
- **`AutomationAssets` (脚本/路径资产):**
    - `id` (主键), `name` (资产名称), `asset_type` (枚举: 'SCRIPT_T1', 'PATH_T2', 'PATH_T3'), `folder_id` (外键->Folders), `app_id` (外键->AppSettings), `current_version_id` (外键->AssetVersions, 指向当前最新版本), `created_at`, `updated_at`, `last_modifier_id` (外键->Users), `lock_status` (枚举: 'LOCKED', 'UNLOCKED'), `lock_owner_id` (外键->Users, 可为空), `lock_timestamp` (锁定时间, 可为空)。
- **`AssetVersions` (资产版本):**
    - `id` (主键), `asset_id` (外键->AutomationAssets), `version_number` (整数), `timestamp` (保存时间), `user_id` (外键->Users, 操作者), `change_message` (用户填写的更改说明, TEXT), `content_diff` (存储版本间差异的文本, TEXT), `is_full_content` (布尔型, 标记是否为第一个完整版本)。(每个 asset_id 最多保留 20 条)
- **`ExecutionTasks` (执行任务):**
    - `id` (主键), `asset_id` (外键->AutomationAssets, 可为空, Target 1 时关联脚本), `task_type` (枚举: 'REPLAY_T1', 'EXPLORE_T2', 'TRAVERSE_T3'), `config_params` (JSON, 存储 Target 2/3 的配置参数), `status` (枚举: 'PENDING', 'RUNNING', 'SUCCESS', 'FAILED', 'DEPENDENCY_FAILED', 'CANCELLED'), `start_time`, `end_time`, `device_id` (执行设备标识), `report_id` (外键->Reports, 可为空), `trigger_user_id` (外键->Users, 提交任务的用户)。
- **`Reports` (报告):**
    - `id` (主键), `task_id` (外键->ExecutionTasks), `report_path` (存储 HTML 报告文件路径) 或 `report_data` (直接存储报告内容, TEXT - (不确定)), `start_time`, `end_time`, `status` (枚举: 'SUCCESS', 'FAILURE', 'WARNING' - 最终报告状态), `summary_data` (JSON, 存储报告摘要信息，如总步数、成功率等)。 *(建议按时间分区)*
- **`ReportSteps` (报告步骤详情):**
    - `id` (主键), `report_id` (外键->Reports), `step_index` (步骤序号), `step_type` (枚举: 'STEP', 'PRIORITY', 'UNCERTAINTY'), `class_name` (操作的目标类名), `action_details` (JSON, 记录具体操作如坐标、文本等), `timestamp` (执行时间), `status` (枚举: 'SUCCESS', 'FAILURE', 'SKIPPED_UNCERTAINTY', 'WARNING_UNCERTAINTY'), `screenshot_path` (关联截图文件路径), `log_snippet` (关键日志片段, TEXT), `confidence_score` (AI 模型置信度, Float, 可为空), `device_state_snapshot` (JSON, 存储设备状态快照)。 *(建议按时间分区)*
- **`ExplorationPaths` (唯一探索路径记录):**
    - `id` (主键), `app_id` (外键->AppSettings), `core_class_sequence_hash` (基于非 uncertainty 步骤 class 序列计算的哈希值, VARCHAR, 在 app_id 内唯一), `path_data` (TEXT 或 JSON, 存储完整路径表示), `path_length` (整数), `first_seen_task_id` (外键->ExecutionTasks, 首次发现此路径的任务)。(用于 `important` 阈值判断和可能的路径分析)
- **`AssetMetadata` (资产元数据 - 路径图备注):**
    - `id` (主键), `asset_id` (外键->AutomationAssets, 关联目标 2 的结果视图?), `node_or_edge_id` (标识路径图中的节点或边), `user_id` (外键->Users, 添加备注者), `timestamp`, `note_content` (备注内容, TEXT)。
- **`AppStatistics` (应用统计 - `important` 计算用):**
    - `app_id` (外键->AppSettings, 主键), `stat_type` (枚举: 'AVG_BRANCHING', 'AVG_FREQUENCY', 主键), `stat_value` (浮点型, 当前全局平均值), `data_point_count` (整数, 用于增量计算的总数据点数), `last_updated` (时间戳)。
- **`ImportantWeights` (`important` 权重配置):**
    - `app_id` (外键->AppSettings, 主键), `current_version_weight` (浮点型, 当前版本权重因子), `history_weight` (浮点型, 历史数据权重因子)。
- **`AdminUnlockLog` (管理员解锁日志):**
    - `id` (主键), `timestamp` (解锁时间), `admin_user_id` (外键->Users), `target_asset_id` (外键->AutomationAssets, 被解锁的文件), `reason` (管理员填写的解锁原因, TEXT)。
- **`EditorUndoRedoState` (编辑器撤销/重做状态持久化):**
    - `id` (主键), `asset_id` (外键->AutomationAssets), `user_id` (外键->Users), `timestamp` (最后更新时间), `undo_stack` (JSON 或 TEXT, 存储撤销栈数据), `redo_stack` (JSON 或 TEXT, 存储重做栈数据)。(用于 Redis 失效后恢复)

**4. 不确定的技术细节**

- **目标 3 路径查找算法:** 用于高效查找所有唯一路径（基于非 `uncertainty` 步骤 `class` 序列）的具体图搜索算法（如 BFS、DFS 变种）及其优化策略。(不确定)
- **目标 2 状态稳定衡量标准:** 用于判断 UI 状态何时达到稳定（作为终止条件之一）的精确定义和参数（例如，连续 X 分钟/步骤未发现新界面/元素）。(不确定)
- **目标 2 覆盖率衡量标准:** 用于计算 UI 覆盖率（作为终止条件之一）的具体指标（例如，基于独特界面数、独特元素 class 数等）。(不确定)
- **目标 2 探索模式具体策略:** 'balanced', 'wide', 'deep' 探索模式影响选择下一个操作的具体算法或启发式规则。(不确定)
- **设备管理/选择机制:** 如何在系统中注册、管理连接的设备（包括 ADB 连接方式），以及用户在提交任务时如何选择目标设备的具体 UI 和后端逻辑。(不确定)
- **AI 模型交互细节:** 加载 `best.pt` 模型并执行推理所使用的具体 Python 库（如 Ultralytics YOLO 库）和 API 调用方式。图像传输到模型前的预处理步骤。(不确定)
- **版本回滚时的图片显示:** 当用户回滚到某个旧版本 JSON 时，编辑器上方面板应如何展示关联截图（是尝试查找并显示旧版本的截图，还是始终显示与文件当前状态关联的最新截图，即使可能不匹配）。（当前确认：显示最新图片）。
- **编辑器 `class` 自动补全来源:** 编辑器中输入 `class` 名称时，自动补全建议列表的数据来源（是动态从当前模型能力集获取，还是从项目中所有脚本的历史 `class` 集合获取，或是基于预定义的列表？）。(不确定)
- **`uncertainty` 步骤的阻塞性判断:** 如何具体定义或配置一个失败的 `uncertainty` 步骤交互是否“阻塞”后续流程（从而决定是记录为警告并继续，还是进入错误处理流程）。(不确定)
- **撤销/重做 JS 库选择:** 用于实现前端编辑器撤销/重做功能的具体 JavaScript 库选型（例如 `undo-manager`, `immer` 等）。(不确定)
- **目标 1 脚本中 `Priority` 步骤的平局处理:** 当在屏幕上同时找到多个具有相同最高优先级的 `class` 元素时，选择哪一个进行操作的具体规则（当前确认：选择第一个找到的）。(不确定)
- **报告数据存储方式:** `Reports.report_data` 字段是存储生成的 HTML 报告的文件路径，还是直接将 HTML 内容存储在数据库字段中。(不确定)
- **编辑器前端缓存策略:** 用户未保存的修改内容在前端的具体缓存技术选型（Vuex 状态管理、Local Storage、Session Storage 等）。(不确定)
- **目标 2/3 起始/结束锚点定义方式:** 用户如何具体定义起始和结束锚点（例如，通过上传目标截图、选择关键元素组合、输入 Activity 名称等）。(不确定)