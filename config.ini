# =====================================
# WFGameAI 中央配置文件
# 目的: 统一管理路径、数据库、OCR、服务等配置
# 重要说明:
# - 优先使用 ${section:option} 或 ${option} 进行路径插值
# - 避免使用绝对路径, 在生产环境使用相对路径或环境变量
# - 本文件由多个服务共享, 修改需评估全局影响
# - 值仅说明用途, 不在此处写入敏感信息
# - 变更前请阅读 `wfgame-ai-server\config_validator.py`
# =====================================

[paths]
# Python 解释器路径. 建议通过环境变量注入, 仅在开发机使用本地路径
python_path = F:\QA\Software\anaconda3\envs\py39_yolov10\python.exe

# 项目根目录. 请避免绝对路径, 推荐由启动脚本动态计算工作目录并传入
project_root = C:\Users\Administrator\PycharmProjects\WFGameAI

# 项目所有页面目录
project_pages_dir = ${project_root}\wfgame-ai-server\staticfiles\pages


# =====================================

# 服务器目录
server_dir = ${project_root}\wfgame-ai-server

# =====================================

# [脚本管理]apps 模块目录
scripts_dir = ${server_dir}\apps\scripts

# =====================================

# [测试用例]apps 模块目录
testcase_dir = ${server_dir}\apps\scripts\testcase

# =====================================

# [报告生成]apps 模块功能目录
reports_dir = ${server_dir}\apps\reports
ui_reports_dir = ${reports_dir}\ui_reports

# =====================================

# [OCR模块]apps 目录与相关路径
ocr_dir = ${server_dir}\apps\ocr
ocr_results_dir = ${project_root}\output\ocr\results
ocr_uploads_dir = ${server_dir}\media
ocr_repos_dir = ${server_dir}\media\ocr\repositories
ocr_temp_dir = ${server_dir}\media\ocr\temp
ocr_exports_dir = ${server_dir}\media\ocr\exports
ocr_logs_dir = ${server_dir}\logs\ocr

# =====================================

# 数据集目录
datasets_dir = ${project_root}\datasets

# 训练结果目录
train_results_dir = ${project_root}\train_results

# 权重文件目录
weights_dir = ${project_root}\models

# 模型文件路径
model_path = ${weights_dir}\best.pt


# =====================================
# 用户及权限认证配置
[auth]

# 注意：
# 生产环境下 sso_web_host 和 sso_api_host 经 nginx 代理后为同一个域名
# 开发环境下 sso_web_host 和 sso_api_host 为不同的 IP:PORT
# SSO 前端网页地址
# sso_web_host = http://127.0.0.1:8848
sso_web_host = https://autoapi.wanfeng-inc.com

# SSO 后端接口地址
# sso_api_host = http://127.0.0.1:8021
sso_api_host = https://autoapi.wanfeng-inc.com

# 是否启用页面路由权限认证
# - true: 启用权限认证, 无权限时跳转到 /pages/no_permission
# - false: 关闭权限认证, 所有页面均可访问
enable_page_auth = false

# 是否启用接口权限认证
# - true: 启用接口权限认证, 无权限时返回 403 错误
# - false: 关闭接口权限认证, 所有接口均可访问
enable_api_auth = false
# =====================================


# =====================================

[devices_report_paths]
# 设备回放后生成报告根目录
device_replay_reports_dir = ${paths:server_dir}\staticfiles\reports

# 设备回放报告生成-静态资源目录
report_static_url = ${device_replay_reports_dir}\static

# 设备回放报告模版
template_dir = ${device_replay_reports_dir}\templates

# 单设备报告目录
single_device_reports_dir = ${device_replay_reports_dir}\ui_run\WFGameAI.air\log

# 多设备汇总报告目录
summary_reports_dir = ${device_replay_reports_dir}\summary_reports

# =====================================

[database]
# MySQL 连接参数. 生产环境请通过环境变量或密钥管理注入敏感信息
host = 172.20.19.101
port = 3306
username = root
password = qa123456
dbname = gogotest_data

# [celery]
# host = 127.0.0.1
# port = 6379
# username =
# password =
# db = 0
# pool_nums = 20

[celery_prod]
host = 127.0.0.1
port = 6379
username =
password =
db = 0
max_connections = 100
socket_connect_timeout = 5
socket_timeout = 5
retry_on_timeout = true
health_check_interval = 30

[redis]
host = 127.0.0.1
port = 6379
username =
password =
db = 0
pool_nums = 20


[account_manager]
# 会话与资源管理配置
# 会话超时时间 (秒)
session_timeout = 3600
# 清理检查间隔 (秒)
cleanup_interval = 300
# 最大并发会话数
max_concurrent_sessions = 100
# 启用 Windows 音效通知
enable_sound_alerts = true
# 数据库连接池大小
db_pool_size = 20
# 心跳检查间隔 (秒)
heartbeat_interval = 60
# 自动迁移文件数据
auto_migrate_on_startup = true

[settings]
# 测试相关设置
default_loop_count = 1
default_max_duration = 30
confidence_threshold = 0.6

# 在配置文件中添加OCR各模式的参数设置

[ocr]
# 基础配置
gpu_enabled = true
ocr_default_lang = ch
log_filter_debug = true
log_filter_debug_save = true

# 功能设置
ocr_cache_enabled = true
ocr_cache_max_size = 4

# GPU配置
gpu_memory_threshold = 4096

# 多线程配置
ocr_max_workers = 1
ocr_batch_size = 50
thread_timeout = 600

# 语言配置
supported_languages = ch,en,jp,ko,vi
default_language = ch


# 性能监控
enable_performance_monitoring = true
monitoring_interval = 10

# 安全配置
max_file_size_mb = 100
max_files_per_task = 1000
allowed_image_formats = jpg,jpeg,png
blocked_file_extensions = exe,dll,bat,sh,cmd,js,php,py

# 文件管理配置
results_retention_days = 30
temp_file_cleanup_interval = 3600
enable_auto_cleanup = true

# 性能优化配置
ocr_instance_pool_enabled = true
ocr_warm_cache_on_startup = true
ocr_flush_interval = 3

# ================= 新增：小图预处理过滤 =================
# 是否在进入默认多轮识别前，抛弃过小分辨率的图片（用于减少极小图误检）
prefilter_small_images_enabled = true
# 以短边像素为判断阈值：若 min(width, height) < 该值，则抛弃
prefilter_min_side_px = 55

# 是否在识别结果中绘制矩形框
draw_enabled = false
# 是否在识别结果中添加注释
annotate_enabled = false
