# =====================================
# WFGameAI 中央配置文件
# 目的: 统一管理路径、数据库、OCR、服务等配置
# 重要说明:
# - 优先使用 ${section:option} 或 ${option} 进行路径插值
# - 避免使用绝对路径, 在生产环境使用相对路径或环境变量
# - 本文件由多个服务共享, 修改需评估全局影响
# - 值仅说明用途, 不在此处写入敏感信息
# - 变更前请阅读 `wfgame-ai-server\config_validator.py`
# =====================================

[paths]
# Python 解释器路径. 建议通过环境变量注入, 仅在开发机使用本地路径
python_path = F:\QA\Software\anaconda3\envs\py39_yolov10\python.exe

# 项目根目录. 请避免绝对路径, 推荐由启动脚本动态计算工作目录并传入
project_root = C:\Users\Administrator\PycharmProjects\WFGameAI

# 项目所有页面目录
project_pages_dir = ${project_root}\wfgame-ai-server\staticfiles\pages

# =====================================

# 服务器目录
server_dir = ${project_root}\wfgame-ai-server

# =====================================

# [脚本管理]apps 模块目录
scripts_dir = ${server_dir}\apps\scripts

# =====================================

# [测试用例]apps 模块目录
testcase_dir = ${server_dir}\apps\scripts\testcase

# =====================================

# [报告生成]apps 模块功能目录

reports_dir = ${server_dir}\apps\reports

ui_reports_dir = ${reports_dir}\ui_reports

# =====================================

# [OCR模块]apps 目录与相关路径
ocr_dir = ${server_dir}\apps\ocr
ocr_results_dir = ${project_root}\output\ocr\results
ocr_uploads_dir = ${server_dir}\media
ocr_repos_dir = ${server_dir}\media\ocr\repositories
ocr_temp_dir = ${server_dir}\media\ocr\temp
ocr_exports_dir = ${server_dir}\media\ocr\exports
ocr_logs_dir = ${server_dir}\logs\ocr

# =====================================

# 数据集目录
datasets_dir = ${project_root}\datasets

# 训练结果目录
train_results_dir = ${project_root}\train_results

# 权重文件目录
weights_dir = ${project_root}\models

# 模型文件路径
#model_path = ${weights_dir}\20250710_best.pt
model_path = ${weights_dir}\best.pt

# =====================================

[devices_report_paths]
# 设备回放后生成报告根目录
device_replay_reports_dir = ${paths:server_dir}\staticfiles\reports

# 设备回放报告生成-静态资源目录
report_static_url = ${device_replay_reports_dir}\static

# 设备回放报告模版
template_dir = ${device_replay_reports_dir}\templates

# 单设备报告目录
single_device_reports_dir = ${device_replay_reports_dir}\ui_run\WFGameAI.air\log

# 多设备汇总报告目录
summary_reports_dir = ${device_replay_reports_dir}\summary_reports

# =====================================

[database]
# MySQL 连接参数. 生产环境请通过环境变量或密钥管理注入敏感信息
host = 127.0.0.1
port = 3306
username = root
password = qa123456
dbname = gogotest_data


[account_manager]
# 会话与资源管理配置
# - session_timeout: 会话空闲超时秒数
# - cleanup_interval: 后台清理循环间隔秒数
# - max_concurrent_sessions: 并发上限, 防止资源耗尽
# - enable_sound_alerts: 是否启用 Windows 提示音
# - db_pool_size: 数据库连接池大小
# - heartbeat_interval: 心跳检测周期秒数
# - auto_migrate_on_startup: 启动时自动迁移或修复配置数据
# 会话超时时间 (秒)
session_timeout = 3600
# 清理检查间隔 (秒)
cleanup_interval = 300
# 最大并发会话数
max_concurrent_sessions = 100
# 启用 Windows 音效通知
enable_sound_alerts = true
# 数据库连接池大小
db_pool_size = 20
# 心跳检查间隔 (秒)
heartbeat_interval = 60
# 自动迁移文件数据
auto_migrate_on_startup = true

[settings]
# 测试相关设置
default_loop_count = 1
default_max_duration = 30
confidence_threshold = 0.6

[ocr]
# OCR 引擎与多线程参数
# - gpu_enabled: 是否启用 GPU 加速
# - ocr_default_lang: 默认识别语言
# - gpu_memory_threshold: 显存阈值 MB, 低于该值触发降级
# - ocr_max_workers: 线程数
# - ocr_batch_size: 批处理大小
# - thread_timeout: 线程超时秒数
# - supported_languages: 支持的语言集合
# - default_language: 默认语言
# - enable_performance_monitoring: 启用性能监控
# - monitoring_interval: 监控采样周期秒数
# - max_file_size_mb: 上传文件大小上限 MB
# - max_files_per_task: 单任务文件数上限
# - allowed_image_formats: 允许的图片格式
# - blocked_file_extensions: 禁止的扩展名
# - results_retention_days: 结果保留天数
# - temp_file_cleanup_interval: 临时文件清理间隔秒数
# - enable_auto_cleanup: 是否启用自动清理
# OCR引擎配置
gpu_enabled = true
ocr_default_lang = ch

# GPU配置
gpu_memory_threshold = 4096

# 多线程配置
ocr_max_workers = 1
ocr_batch_size = 20
thread_timeout = 600

# 语言配置
supported_languages = ch,en,jp,ko,vi
default_language = ch

# 性能监控
enable_performance_monitoring = true
monitoring_interval = 10

# 安全配置
max_file_size_mb = 100
max_files_per_task = 1000
allowed_image_formats = jpg,jpeg,png,bmp,tiff,tif,webp
blocked_file_extensions = exe,dll,bat,sh,cmd,js,php,py

# 文件管理配置
results_retention_days = 30
temp_file_cleanup_interval = 3600
enable_auto_cleanup = true

# 文本过滤与去噪配置（用于减少纯图片/图标等被误识别为中文的情况）
# 基础过滤
enable_filter = true
# 文字识别最小置信度
min_rec_score = 0.85
# 文字识别最小长度
min_text_length = 1
# 文字识别最小中文比例
min_chinese_ratio = 0.7
# 边缘密度
min_edge_density = 0.01
# 文本框最小面积占比
min_box_area_ratio = 0.0001
# 文本框最大面积占比
max_box_area_ratio = 0.95
# NMS 交并比阈值
nms_iou_threshold = 0.5
# 非文本过滤
enable_non_text_filter = true

# 细粒度文本框过滤（新增）
# 单字符是否允许。若为 false，则对单字符启用更严格门限
allow_single_char = false
# 单字符最小置信度（仅在 allow_single_char=false 时生效）
single_char_min_score = 0.97
# 单字符ROI最小边缘密度（0-1），越大越严格，建议 0.03~0.08
single_char_min_edge_density = 0.08
# 单字符最小框面积占比，防止整块背景被当作单字
single_char_min_box_area_ratio = 0.0002
# 文本框内最小边缘密度（0-1），低于该值视为图形/空白
min_box_edge_density = 0.03
# 文本框像素最小宽/高，过小往往是噪声
min_box_width_px = 14
min_box_height_px = 14
# 文本框长宽比范围，用于排除接近正方的装饰元素或极端长条噪声
min_box_aspect_ratio = 0.25
max_box_aspect_ratio = 5.0

# 用于识别边框/徽章类误检的边缘特征过滤
# 计算ROI中靠近边界处的边缘像素占比，过高则视为边框而非文字
border_edge_margin_px = 3
max_border_edge_ratio = 0.9

# 调试：是否记录每张图片前若干候选的过滤决策及参数（默认false，建议问题定位时开启）
log_filter_debug = true
log_filter_debug_max_items = 5

# 中心区域边缘密度（用于剔除只有边框无内部笔画的框）
center_edge_margin_ratio = 0.2
min_center_edge_density = 0.01
single_char_min_center_edge_density = 0.03

# 当所有候选被过滤为空时，是否回退保留全部候选（不建议，默认false）
filter_empty_fallback = false

# 大文本框放宽（适配标题/Logo贴图等文字占比很大的图片）
allow_large_text_box = true
large_box_area_ratio = 0.90
large_box_min_center_edge_density = 0.03
large_box_min_interior_border_ratio = 0.60
