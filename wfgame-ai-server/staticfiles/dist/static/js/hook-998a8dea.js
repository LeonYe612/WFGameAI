import{aP as d,r as l,o as w,aN as u,aO as g}from"./index-c3bc70ba.js";import{c as y}from"./rules-1d693796.js";const x=s=>d.request("post","/api/reports/summary_list/",{data:s||{}}),_=s=>d.request("post","/api/reports/delete/",{data:s}),B=()=>{const s=l(!1),c=l([]),t=l({search:"",successRate:"all",date:""}),r=async()=>{var a;try{s.value=!0;const e={};t.value.search&&(e.search=t.value.search),t.value.successRate!=="all"&&(e.success_rate=t.value.successRate),t.value.date&&(e.date=t.value.date);const R=(((a=(await x(e)).data)==null?void 0:a.reports)||[]).map(o=>{const i=o.devices?o.devices.length:0,m=y(o.success_count,i);return{...o,successRate:m,deviceCount:i}});c.value=R}catch(e){console.error("加载报告列表失败:",e),u.error("加载报告列表失败"),c.value=[]}finally{s.value=!1}},p=()=>{r()},h=async(a,e)=>{try{switch(a){case"view":window.open(e.url,"_blank");break;case"delete":await g.confirm("确认删除该报告？删除后无法恢复！","危险操作",{confirmButtonText:"删除",cancelButtonText:"取消",type:"error"}),await _({id:e.id}),u.success("报告删除成功"),await r();break;default:console.warn("未知操作:",a)}}catch(n){n!=="cancel"&&(console.error(`执行操作 ${a} 失败:`,n),u.error("操作失败"))}},f=()=>{r()},v=()=>{window.location.href="/automation/"};return w(()=>{r()}),{loading:s,reportList:c,filters:t,loadReports:r,handleFilterChange:p,handleReportAction:h,handleRefresh:f,handleCreateTest:v}};export{B as useReportsPage};
