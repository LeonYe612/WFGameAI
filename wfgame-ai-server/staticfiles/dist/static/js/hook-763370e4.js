import{b as c,a as n}from"./ocr-397e26db.js";import{s as m}from"./request-d2ecd641.js";import{r as i,aF as s,aO as R}from"./index-e046f3d2.js";const L=()=>{const w=i([]),f=i([]),h=i([]),a=async()=>{try{return await c.list()}catch(r){s("获取代码库列表失败",{type:"error"}),console.error("fetchRepositories error:",r)}};return{repositories:w,tasks:f,results:h,fetchRepositories:a,addRepository:async(r,e)=>{try{await c.create({...e}),await a()}catch(o){console.error("createRepository error:",o)}},removeRepository:async(r,e)=>{try{await R.confirm("确定要删除这个代码库吗？","确认删除",{type:"warning"}),await c.delete(e),await a()}catch(o){o!=="cancel"&&console.error("deleteRepository error:",o)}},fetchTasks:async r=>{try{return await m({apiFunc:n.history,apiParams:{...r},enableSucceedMsg:!1})}catch(e){s("获取任务列表失败",{type:"error"}),console.error("fetchTasks error:",e)}},deleteTask:async r=>{try{await m({apiFunc:n.delete,apiParams:r,enableSucceedMsg:!0})}catch(e){s("删除任务失败",{type:"error"}),console.error("deleteTask error:",e)}},downloadTask:async r=>{try{const e=await n.download(r),o=e.data,u=new Blob([o],{type:"text/csv"}),d=e.headers["content-disposition"];let l="download.csv";if(d){const y=d.match(/filename=([^;]+)/i);y&&(l=decodeURIComponent(y[1].replace(/['"]/g,"")))}const p=window.URL.createObjectURL(u),t=document.createElement("a");t.href=p,t.download=l||`ocr_results_${r}.csv`,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(p),t.remove()}catch(e){s("下载任务结果失败",{type:"error"}),console.error("downloadTask error:",e)}}}};export{L as useOcr};
