import{g as ie,A as ce,z as de,k as pe,m as ue}from"./index-ccf167da.js";import{s as _e,t as k,d as me,e as ge}from"./enums-b2002ef1.js";import{a_ as fe,aE as P,m as he,r as x,a0 as $,o as ye,A as n,O as ke,j as p,k as T,z as a,I as l,F as ve,p as we,u as h,x as r,B as u,P as be,y as _,l as m,R as C,_ as Ce}from"./index-fbbdd03e.js";import{useNavigate as De}from"./navHook-089e0a35.js";import{useOcr as ze}from"./hook-088120c0.js";import"./ocr-8f40b38a.js";import"./request-2aeceb02.js";const xe=v=>{fe(v)?P(`${v} 已复制到系统剪切板`,{type:"success"}):P("复制到系统剪切板失败",{type:"error"})},Te={class:"flex-full flex-col gap-2"},Ve={class:"source-info"},Se={key:2};const Be={class:"creation-info"},Ee={class:"creator"},Ne={class:"create-time"},Oe={class:"pagination-wrapper"};const Pe=he({__name:"OcrTaskHistory",props:{fetchData:{type:Function}},emits:["view-task","view-results","download","delete","create-task","data-loaded"],setup(v,{expose:V,emit:F}){const{navigateToOcrResult:I}=De(),{deleteTask:L,downloadTask:R}=ze(),j=v,g=F,w=x(!1),b=x([]),D=x(null),S={startDate:"",endDate:"",status:""},c=$({...S}),s=$({currentPage:1,pageSize:20,total:0}),B=t=>t.status===k.COMPLETED.value||t.status===k.FAILED.value,d=async()=>{w.value=!1;try{const t={...c,page:s.currentPage,page_size:s.pageSize},o=await j.fetchData(t);b.value=o.data.tasks||[],s.total=o.data.total||0,g("data-loaded",o)}catch(t){console.error("Failed to fetch table data:",t),b.value=[],s.total=0}finally{w.value=!1}},A=()=>{s.currentPage=1,d()},H=()=>{Object.assign(c,S),D.value=null,s.currentPage=1,d()},U=t=>{s.currentPage=t,d()},M=t=>{s.pageSize=t,s.currentPage=1,d()},G=t=>t.source_type==="git"?`${t.git_repository_url} (${t.git_branch})`:"用户自定义上传",q=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",J=t=>{t?(c.startDate=t[0].toISOString().split("T")[0],c.endDate=t[1].toISOString().split("T")[0]):(c.startDate="",c.endDate=""),d()},K=t=>{xe(t.id),g("view-task",t)},Q=t=>{g("view-results",t),I(t.id)},W=t=>{R(t.id),g("download",t)},X=t=>{L(t.id).then(()=>{d(),g("delete",t)})},$e=()=>{g("create-task")},Y=()=>{d()};return ye(()=>{d()}),V({refresh:Y}),(t,o)=>{const Z=n("el-option"),ee=n("el-select"),z=n("el-form-item"),te=n("el-date-picker"),y=n("el-button"),ae=n("el-form"),E=n("el-card"),le=n("el-link"),i=n("el-table-column"),N=n("el-tag"),O=n("el-progress"),oe=n("el-popconfirm"),ne=n("el-table"),se=n("el-pagination"),Fe=n("el-empty"),re=ke("loading");return p(),T("div",Te,[a(E,{class:"filter-card"},{default:l(()=>[a(ae,{model:c,inline:""},{default:l(()=>[a(z,{label:"状态"},{default:l(()=>[a(ee,{modelValue:c.status,"onUpdate:modelValue":o[0]||(o[0]=e=>c.status=e),placeholder:"所有状态",clearable:"",style:{width:"120px"},onChange:d},{default:l(()=>[(p(!0),T(ve,null,we(r(_e)(r(k)),e=>(p(),h(Z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(z,{label:"时间范围"},{default:l(()=>[a(te,{modelValue:D.value,"onUpdate:modelValue":o[1]||(o[1]=e=>D.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"},onChange:J},null,8,["modelValue"])]),_:1}),a(z,null,{default:l(()=>[a(y,{icon:r(ie),type:"primary",onClick:A,plain:""},{default:l(()=>[...o[2]||(o[2]=[u(" 搜索 ",-1)])]),_:1},8,["icon"]),a(y,{icon:r(ce),onClick:H},{default:l(()=>[...o[3]||(o[3]=[u(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),a(E,{class:"table-card"},{default:l(()=>[be((p(),h(ne,{data:b.value,stripe:"",style:{width:"100%"},height:"100%"},{default:l(()=>[a(i,{prop:"id",label:"任务ID",width:"220"},{default:l(({row:e})=>[a(le,{type:"primary",onClick:f=>K(e)},{default:l(()=>[u(_(e.id),1)]),_:2},1032,["onClick"])]),_:1}),a(i,{prop:"source",label:"数据来源","min-width":"200","show-overflow-tooltip":""},{default:l(({row:e})=>[m("div",Ve,[a(N,{type:e.source_type==="git"?"success":"warning",size:"small",class:"source-type-tag"},{default:l(()=>[u(_(e.source_type==="git"?"Git":"Upload"),1)]),_:2},1032,["type"]),m("span",null,_(G(e)),1)])]),_:1}),a(i,{prop:"status",label:"状态",width:"100"},{default:l(({row:e})=>{var f;return[a(N,{type:(f=r(me)(r(k),e.status))==null?void 0:f.type,size:"small"},{default:l(()=>[u(_(r(ge)(r(k),e.status)),1)]),_:2},1032,["type"])]}),_:1}),a(i,{prop:"progress",label:"进度",width:"180"},{default:l(({row:e})=>[e.status==="running"?(p(),h(O,{key:0,percentage:e.progress||0,"stroke-width":10,striped:"","striped-flow":""},null,8,["percentage"])):e.status==="completed"?(p(),h(O,{key:1,percentage:100,status:"success","stroke-width":10})):(p(),T("span",Se,"-"))]),_:1}),a(i,{prop:"duration",label:"耗时",width:"120"},{default:l(({row:e})=>[u(_(e.duration||"-"),1)]),_:1}),a(i,{prop:"total_images",label:"图片总数",width:"100"}),a(i,{prop:"matched_images",label:"命中数",width:"100"}),a(i,{prop:"match_rate",label:"匹配率",width:"100",align:"center"},{default:l(({row:e})=>[m("span",null,_(`${e.match_rate}%`),1)]),_:1}),C("",!0),a(i,{prop:"created_at",label:"创建信息",width:"180"},{default:l(({row:e})=>[m("div",Be,[m("span",Ee,_(e.creator_username||"未知"),1),m("span",Ne,_(q(e.created_at)),1)])]),_:1}),a(i,{label:"操作",fixed:"right",width:280},{default:l(({row:e})=>[B(e)?(p(),h(y,{key:0,type:"primary",size:"small",plain:"",icon:r(de),onClick:f=>Q(e)},{default:l(()=>[...o[4]||(o[4]=[u(" 查看 ",-1)])]),_:1},8,["icon","onClick"])):C("",!0),B(e)?(p(),h(y,{key:1,type:"warning",size:"small",plain:"",icon:r(pe),onClick:f=>W(e)},{default:l(()=>[...o[5]||(o[5]=[u(" 下载 ",-1)])]),_:1},8,["icon","onClick"])):C("",!0),a(oe,{title:"是否确认删除?",onConfirm:f=>X(e)},{reference:l(()=>[a(y,{type:"danger",size:"small",plain:"",icon:r(ue)},{default:l(()=>[...o[6]||(o[6]=[u(" 删除 ",-1)])]),_:1},8,["icon"])]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[re,w.value]]),m("div",Oe,[a(se,{"current-page":s.currentPage,"page-size":s.pageSize,total:s.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:U},null,8,["current-page","page-size","total"])]),(!w.value&&b.value.length,C("",!0))]),_:1})])}}});const Me=Ce(Pe,[["__scopeId","data-v-004e2e36"]]);export{Me as default};
