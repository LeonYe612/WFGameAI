import{l as M,r as C,a as F,c as w,g as R}from"./devices-446fb759.js";import{s as i}from"./request-6dd7bfdd.js";import{r as c,c as m,aF as v}from"./index-c3bc70ba.js";function V(){const n=c([]),d=c(!1),f=c(""),h=c({total:0,online:0,offline:0,unauthorized:0,busy:0}),p=c(""),g=c(""),D=c("table"),o=c("device_id"),l=c("asc"),S=m(()=>{const e=n.value.length,t=n.value.filter(s=>s.status==="online"||s.status==="device").length,a=n.value.filter(s=>s.status==="offline").length,r=n.value.filter(s=>s.status==="unauthorized").length,u=n.value.filter(s=>s.status==="busy").length;return{total:e,online:t,offline:a,unauthorized:r,busy:u}}),b=m(()=>{let e=[...n.value];if(p.value){const t=p.value.toLowerCase();e=e.filter(a=>{var r,u,s;return((r=a.device_id)==null?void 0:r.toLowerCase().includes(t))||((u=a.brand)==null?void 0:u.toLowerCase().includes(t))||((s=a.model)==null?void 0:s.toLowerCase().includes(t))})}return g.value&&(e=e.filter(t=>t.status===g.value)),o.value&&(e=e.sort((t,a)=>{const r=t[o.value]||"",u=a[o.value]||"",s=r.toString().localeCompare(u.toString());return l.value==="asc"?s:-s})),e}),y=async()=>{await i({apiFunc:M,onBeforeRequest:()=>{d.value=!0,f.value=""},onSucceed:e=>{n.value=e,h.value=S.value},onFailed:e=>{f.value=e.message||"获取设备列表失败",n.value=[]},onCompleted:()=>{d.value=!1}})};return{devices:n,loading:d,error:f,stats:h,searchQuery:p,statusFilter:g,viewMode:D,sortField:o,sortDirection:l,computedStats:S,filteredAndSortedDevices:b,fetchDevices:y,refreshDevices:async()=>{await i({apiFunc:C,enableSucceedMsg:!0,succeedMsgContent:"设备列表刷新成功！",onSucceed:()=>{y()},onFailed:()=>{v("刷新设备列表失败",{type:"error"})}})},connectDevice:async e=>{await i({apiFunc:F,apiParams:e,enableSucceedMsg:!0,succeedMsgContent:"设备连接成功！",onSucceed:()=>{y()},onFailed:()=>{v("设备连接失败",{type:"error"})}})},performUsbCheck:async()=>{let e=null;return await i({apiFunc:w,enableSucceedMsg:!0,succeedMsgContent:"USB连接检查完成！",onSucceed:t=>{e=t},onFailed:()=>{v("USB连接检查失败",{type:"error"})}}),e},generateDeviceReport:async e=>{let t=null;return await i({apiFunc:R,apiParams:e,enableSucceedMsg:!0,succeedMsgContent:"设备报告生成成功！",onSucceed:a=>{t=a},onFailed:()=>{v("生成设备报告失败",{type:"error"})}}),t},getStatusText:e=>({online:"在线",offline:"离线",device:"已连接",busy:"忙碌",unauthorized:"未授权"})[e]||e,getStatusType:e=>({online:"success",device:"success",offline:"danger",busy:"warning",unauthorized:"warning"})[e]||"info",sortBy:e=>{o.value===e?l.value=l.value==="asc"?"desc":"asc":(o.value=e,l.value="asc")}}}export{V as useDevicesManagement};
