import{d as H,e as $,f as z,p as K}from"./index-ccf167da.js";import{D as L}from"./types-5a18ccfd.js";import{d as O,a as Y}from"./rules-a40408e3.js";import{m as q,r as b,A as d,j as n,u as r,I as t,l as w,z as a,B as m,y as D,k as g,p as B,x as c,F,R as v}from"./index-fbbdd03e.js";const J={class:"flex items-center"},M={key:0},Q={key:1},W=["accept"],X={class:"flex justify-end space-x-2"},te=q({name:"DataSourceDialog",__name:"dataSourceDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirm"],setup(Z,{expose:S,emit:R}){const V=R,_=b(),C=b(),l=b({name:"",type:"excel",description:"",config:{}}),f=b(!1),j=u=>{u?(l.value={...u},f.value=!0):(l.value={name:"",type:"excel",description:"",config:{}},f.value=!1),V("update:modelValue",!0)},k=()=>{var u;V("update:modelValue",!1),(u=_.value)==null||u.resetFields()},E=async()=>{if(_.value)try{await _.value.validate(),V("confirm",l.value),k()}catch(u){console.error("表单验证失败:",u)}},N=u=>{var s;const i=(s=u.target.files)==null?void 0:s[0];i&&(l.value.config||(l.value.config={}),l.value.config.filePath=i.name)},P=[{key:"host",label:"主机地址",placeholder:"localhost"},{key:"port",label:"端口",placeholder:"3306"},{key:"database",label:"数据库名",placeholder:"database_name"},{key:"username",label:"用户名",placeholder:"username"},{key:"password",label:"密码",placeholder:"password",type:"password"}];return S({showDialog:j}),(u,o)=>{const i=d("el-input"),s=d("el-form-item"),T=d("el-icon"),p=d("el-option"),x=d("el-select"),U=d("el-divider"),h=d("el-button"),A=d("el-switch"),I=d("el-form"),G=d("el-dialog");return n(),r(G,{"model-value":u.modelValue,title:f.value?"编辑数据源":"新建数据源",width:"600px",draggable:!0,onClose:k},{footer:t(()=>[w("div",X,[a(h,{onClick:k},{default:t(()=>[...o[11]||(o[11]=[m("取消",-1)])]),_:1}),a(h,{type:"primary",onClick:E},{default:t(()=>[m(D(f.value?"更新":"创建"),1)]),_:1})])]),default:t(()=>[a(I,{ref_key:"formRef",ref:_,model:l.value,rules:c(Y),"label-width":"100px","label-position":"left"},{default:t(()=>[a(s,{label:"数据源名称",prop:"name"},{default:t(()=>[a(i,{modelValue:l.value.name,"onUpdate:modelValue":o[0]||(o[0]=e=>l.value.name=e),placeholder:"请输入数据源名称",clearable:""},null,8,["modelValue"])]),_:1}),a(s,{label:"数据源类型",prop:"type"},{default:t(()=>[a(x,{modelValue:l.value.type,"onUpdate:modelValue":o[1]||(o[1]=e=>l.value.type=e),placeholder:"请选择数据源类型",style:{width:"100%"},disabled:f.value},{default:t(()=>[(n(!0),g(F,null,B(c(L),e=>(n(),r(p,{key:e.value,label:e.label,value:e.value},{default:t(()=>[w("div",J,[a(T,{class:"mr-2"},{default:t(()=>[e.value==="excel"||e.value==="csv"?(n(),r(c(H),{key:0})):e.value==="database"?(n(),r(c($),{key:1})):(n(),r(c(z),{key:2}))]),_:2},1024),m(" "+D(e.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(s,{label:"描述",prop:"description"},{default:t(()=>[a(i,{modelValue:l.value.description,"onUpdate:modelValue":o[2]||(o[2]=e=>l.value.description=e),type:"textarea",rows:3,placeholder:"请输入数据源描述（可选）"},null,8,["modelValue"])]),_:1}),l.value.type==="database"?(n(),g("div",M,[a(U,{"content-position":"left"},{default:t(()=>[...o[8]||(o[8]=[m("数据库连接配置",-1)])]),_:1}),(n(),g(F,null,B(P,e=>a(s,{key:e.key,label:e.label,prop:`config.${e.key}`,rules:c(O)[e.key]},{default:t(()=>[a(i,{modelValue:l.value.config[e.key],"onUpdate:modelValue":y=>l.value.config[e.key]=y,type:e.type||"text",placeholder:e.placeholder,clearable:""},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])]),_:2},1032,["label","prop","rules"])),64))])):v("",!0),["excel","csv","json"].includes(l.value.type)?(n(),g("div",Q,[a(U,{"content-position":"left"},{default:t(()=>[...o[9]||(o[9]=[m("文件配置",-1)])]),_:1}),a(s,{label:"文件路径"},{default:t(()=>[a(i,{modelValue:l.value.config.filePath,"onUpdate:modelValue":o[4]||(o[4]=e=>l.value.config.filePath=e),placeholder:"请输入文件路径或上传文件",clearable:""},{append:t(()=>[a(h,{icon:c(K),onClick:o[3]||(o[3]=e=>{var y;return(y=C.value)==null?void 0:y.click()})},{default:t(()=>[...o[10]||(o[10]=[m(" 选择文件 ",-1)])]),_:1},8,["icon"])]),_:1},8,["modelValue"]),w("input",{ref_key:"fileInput",ref:C,type:"file",style:{display:"none"},accept:l.value.type==="excel"?".xlsx,.xls":l.value.type==="csv"?".csv":".json",onChange:N},null,40,W)]),_:1}),l.value.type==="csv"?(n(),r(s,{key:0,label:"编码格式"},{default:t(()=>[a(x,{modelValue:l.value.config.encoding,"onUpdate:modelValue":o[5]||(o[5]=e=>l.value.config.encoding=e),placeholder:"请选择编码格式",style:{width:"100%"}},{default:t(()=>[a(p,{label:"UTF-8",value:"utf-8"}),a(p,{label:"GBK",value:"gbk"}),a(p,{label:"GB2312",value:"gb2312"})]),_:1},8,["modelValue"])]),_:1})):v("",!0),l.value.type==="csv"?(n(),r(s,{key:1,label:"分隔符"},{default:t(()=>[a(x,{modelValue:l.value.config.delimiter,"onUpdate:modelValue":o[6]||(o[6]=e=>l.value.config.delimiter=e),placeholder:"请选择分隔符",style:{width:"100%"}},{default:t(()=>[a(p,{label:"逗号 (,)",value:","}),a(p,{label:"分号 (;)",value:";"}),a(p,{label:"制表符",value:"\\t"})]),_:1},8,["modelValue"])]),_:1})):v("",!0),["excel","csv"].includes(l.value.type)?(n(),r(s,{key:2,label:"包含表头"},{default:t(()=>[a(A,{modelValue:l.value.config.hasHeader,"onUpdate:modelValue":o[7]||(o[7]=e=>l.value.config.hasHeader=e)},null,8,["modelValue"])]),_:1})):v("",!0)])):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}});export{te as _};
