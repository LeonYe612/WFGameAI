import{I as q,N as E,i as H,r as Q,n as F}from"./index-8ca571cf.js";import{T as B,g as J}from"./tasks-56621e25.js";import{t as N,a as z}from"./rules-eab1a540.js";import{l as K,c as M,r as L,w as O,z as u,h as n,q as v,H as t,k as a,y as s,A as c,v as l,Q as w,j as g,x as _,u as U,ah as P,ai as W,_ as X}from"./index-e046f3d2.js";const i=m=>(P("data-v-12389050"),m=m(),W(),m),Y={key:0,class:"task-detail"},Z=i(()=>a("div",{class:"card-header"},[a("span",null,"基本信息")],-1)),x={class:"info-item"},ee=i(()=>a("label",null,"任务名称：",-1)),te={class:"info-item"},se=i(()=>a("label",null,"任务状态：",-1)),ae={class:"info-item"},le=i(()=>a("label",null,"任务类型：",-1)),oe={class:"info-item"},ne=i(()=>a("label",null,"目标设备：",-1)),ie={class:"info-item"},de=i(()=>a("label",null,"开始时间：",-1)),ue={class:"info-item"},ce=i(()=>a("label",null,"执行耗时：",-1)),_e={key:0,class:"info-item full-width"},re=i(()=>a("label",null,"任务描述：",-1)),pe={class:"description"},fe={class:"card-header"},me=i(()=>a("span",null,"执行日志",-1)),ke={class:"logs-container"},ve={key:0,class:"logs-loading"},ge={key:1,class:"logs-content"},he={key:2,class:"logs-empty"},ye={class:"dialog-footer"},be=K({__name:"taskDetailDialog",props:{visible:{type:Boolean,default:!1},task:{default:null},loading:{type:Boolean,default:!1}},emits:["update:visible","action"],setup(m,{emit:D}){const p=m,C=M({get:()=>p.visible,set:e=>D("update:visible",e)}),h=L(""),y=L(!1);O(()=>p.task,e=>{e&&V()},{immediate:!0});const V=async()=>{if(p.task)try{y.value=!0;const e=await J(p.task.id);h.value=e.data||"暂无日志信息"}catch(e){console.error("加载日志失败:",e),h.value="加载日志失败"}finally{y.value=!1}},I=e=>{p.task&&D("action",e,p.task)},$=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--";return(e,d)=>{const f=u("el-col"),r=u("el-icon"),A=u("el-tag"),G=u("el-row"),S=u("el-card"),b=u("el-button"),R=u("el-scrollbar"),j=u("el-dialog");return n(),v(j,{modelValue:C.value,"onUpdate:modelValue":d[3]||(d[3]=o=>C.value=o),title:"任务详情",width:"800px","close-on-click-modal":!1},{footer:t(()=>[a("div",ye,[s(b,{onClick:d[0]||(d[0]=o=>C.value=!1)},{default:t(()=>[c(" 关闭 ")]),_:1}),e.task&&e.task.status!==l(B).RUNNING?(n(),v(b,{key:0,type:"primary",onClick:d[1]||(d[1]=o=>I("start"))},{default:t(()=>[s(r,null,{default:t(()=>[s(l(q))]),_:1}),c(" 启动任务 ")]),_:1})):w("",!0),e.task&&e.task.status===l(B).RUNNING?(n(),v(b,{key:1,type:"danger",onClick:d[2]||(d[2]=o=>I("stop"))},{default:t(()=>[s(r,null,{default:t(()=>[s(l(E))]),_:1}),c(" 停止任务 ")]),_:1})):w("",!0)])]),default:t(()=>[e.task?(n(),g("div",Y,[s(S,{class:"info-card",shadow:"never"},{header:t(()=>[Z]),default:t(()=>[s(G,{gutter:24},{default:t(()=>[s(f,{span:12},{default:t(()=>[a("div",x,[ee,a("span",null,_(e.task.name),1)])]),_:1}),s(f,{span:12},{default:t(()=>{var o;return[a("div",te,[se,s(A,{type:(o=l(N)[e.task.status])==null?void 0:o.type,size:"small"},{default:t(()=>{var k;return[s(r,{class:"status-icon"},{default:t(()=>{var T;return[(n(),v(U((T=l(N)[e.task.status])==null?void 0:T.icon)))]}),_:1}),c(" "+_((k=l(N)[e.task.status])==null?void 0:k.label),1)]}),_:1},8,["type"])])]}),_:1}),s(f,{span:12},{default:t(()=>{var o;return[a("div",ae,[le,a("span",null,[s(r,null,{default:t(()=>{var k;return[(n(),v(U((k=l(z)[e.task.type])==null?void 0:k.icon)))]}),_:1}),c(" "+_((o=l(z)[e.task.type])==null?void 0:o.label),1)])])]}),_:1}),s(f,{span:12},{default:t(()=>[a("div",oe,[ne,a("span",null,[s(r,null,{default:t(()=>[s(l(H))]),_:1}),c(" "+_(e.task.device),1)])])]),_:1}),s(f,{span:12},{default:t(()=>[a("div",ie,[de,a("span",null,_($(e.task.startTime)),1)])]),_:1}),s(f,{span:12},{default:t(()=>[a("div",ue,[ce,a("span",null,_(e.task.duration||"--"),1)])]),_:1})]),_:1}),e.task.description?(n(),g("div",_e,[re,a("p",pe,_(e.task.description),1)])):w("",!0)]),_:1}),s(S,{class:"logs-card",shadow:"never"},{header:t(()=>[a("div",fe,[me,s(b,{size:"small",loading:y.value,onClick:V},{default:t(()=>[s(r,null,{default:t(()=>[s(l(Q))]),_:1}),c(" 刷新日志 ")]),_:1},8,["loading"])])]),default:t(()=>[a("div",ke,[s(R,{height:"300px"},{default:t(()=>[y.value?(n(),g("div",ve,[s(r,{class:"is-loading"},{default:t(()=>[s(l(F))]),_:1}),c(" 加载日志中... ")])):h.value?(n(),g("pre",ge,_(h.value),1)):(n(),g("div",he,"暂无日志信息"))]),_:1})])]),_:1})])):w("",!0)]),_:1},8,["modelValue"])}}});const Ve=X(be,[["__scopeId","data-v-12389050"]]);export{Ve as default};
