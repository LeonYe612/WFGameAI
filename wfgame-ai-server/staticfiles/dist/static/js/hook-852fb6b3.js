import{b as B,c as S,d as z,e as C,r as E,s as L,f as M}from"./tasks-b16f8164.js";import{r as l,a0 as V,o as A,aP as t,aG as f}from"./index-41f05ddf.js";const R=()=>{const u=l(!1),p=l([]),n=l({search:"",status:"all",type:"all"}),c=V({currentPage:1,pageSize:20,total:0}),i=l(!1),g=l(!1),d=l(!1),o=l(null),a=async()=>{var e,s;try{u.value=!0;const r={page:c.currentPage,pageSize:c.pageSize};n.value.search&&(r.search=n.value.search),n.value.status!=="all"&&(r.status=n.value.status),n.value.type!=="all"&&(r.type=n.value.type);const h=await B(r);p.value=((e=h.data)==null?void 0:e.results)||[],c.total=((s=h.data)==null?void 0:s.count)||0}catch(r){console.error("加载任务列表失败:",r),t.error("加载任务列表失败")}finally{u.value=!1}},w=()=>{c.currentPage=1,a()},T=e=>{c.currentPage=e,a()},k=e=>{c.pageSize=e,c.currentPage=1,a()},y=()=>{o.value=null,i.value=!0},m=e=>{o.value=e,i.value=!0},v=e=>{o.value=e,g.value=!0},b=async e=>{try{d.value=!0,o.value?t.success("任务更新成功"):(await S({name:e.name,type:e.type,device:e.device,description:e.description}),t.success("任务创建成功")),i.value=!1,await a()}catch(s){console.error("保存任务失败:",s),t.error("保存任务失败")}finally{d.value=!1}},x=async(e,s)=>{try{switch(e){case"start":await M(s.id),t.success("任务启动成功"),await a();break;case"stop":await f.confirm("确认停止该任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await L(s.id),t.success("任务已停止"),await a();break;case"restart":await E(s.id),t.success("任务重启成功"),await a();break;case"view":v(s);break;case"duplicate":await f.confirm("确认复制该任务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),await C(s.id),t.success("任务复制成功"),await a();break;case"delete":await f.confirm("确认删除该任务？删除后无法恢复！","危险操作",{confirmButtonText:"删除",cancelButtonText:"取消",type:"error"}),await z(s.id),t.success("任务删除成功"),await a();break;default:console.warn("未知操作:",e)}}catch(r){r!=="cancel"&&(console.error(`执行操作 ${e} 失败:`,r),t.error("操作失败"))}},P=()=>{a()};return A(()=>{a()}),{loading:u,taskList:p,filters:n,pagination:c,formDialogVisible:i,detailDialogVisible:g,formLoading:d,currentTask:o,loadTasks:a,handleFilterChange:w,handlePageChange:T,handleSizeChange:k,handleCreateTask:y,handleEditTask:m,handleViewTask:v,handleSubmitTask:b,handleTaskAction:x,handleRefresh:P}};export{R as useTasksPage};
