import{d as G,e as I,f as $,p as q}from"./index-8ca571cf.js";import{D as z}from"./types-5a18ccfd.js";import{d as K,a as L}from"./rules-3e6faffa.js";import{l as O,r as b,z as s,h as n,q as r,H as o,k as w,y as a,A as m,x as D,j as g,m as B,v as p,F,Q as v}from"./index-e046f3d2.js";const Q={class:"flex items-center"},Y={key:0},J={key:1},M=["accept"],W={class:"flex justify-end space-x-2"},oe=O({name:"DataSourceDialog",__name:"dataSourceDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","confirm"],setup(X,{expose:S,emit:V}){const _=b(),C=b(),l=b({name:"",type:"excel",description:"",config:{}}),f=b(!1),R=u=>{u?(l.value={...u},f.value=!0):(l.value={name:"",type:"excel",description:"",config:{}},f.value=!1),V("update:modelValue",!0)},k=()=>{var u;V("update:modelValue",!1),(u=_.value)==null||u.resetFields()},j=async()=>{if(_.value)try{await _.value.validate(),V("confirm",l.value),k()}catch(u){console.error("表单验证失败:",u)}},E=u=>{var d;const i=(d=u.target.files)==null?void 0:d[0];i&&(l.value.config||(l.value.config={}),l.value.config.filePath=i.name)},N=[{key:"host",label:"主机地址",placeholder:"localhost"},{key:"port",label:"端口",placeholder:"3306"},{key:"database",label:"数据库名",placeholder:"database_name"},{key:"username",label:"用户名",placeholder:"username"},{key:"password",label:"密码",placeholder:"password",type:"password"}];return S({showDialog:R}),(u,t)=>{const i=s("el-input"),d=s("el-form-item"),P=s("el-icon"),c=s("el-option"),h=s("el-select"),U=s("el-divider"),x=s("el-button"),T=s("el-switch"),A=s("el-form"),H=s("el-dialog");return n(),r(H,{"model-value":u.modelValue,title:f.value?"编辑数据源":"新建数据源",width:"600px",draggable:!0,onClose:k},{footer:o(()=>[w("div",W,[a(x,{onClick:k},{default:o(()=>[m("取消")]),_:1}),a(x,{type:"primary",onClick:j},{default:o(()=>[m(D(f.value?"更新":"创建"),1)]),_:1})])]),default:o(()=>[a(A,{ref_key:"formRef",ref:_,model:l.value,rules:p(L),"label-width":"100px","label-position":"left"},{default:o(()=>[a(d,{label:"数据源名称",prop:"name"},{default:o(()=>[a(i,{modelValue:l.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.name=e),placeholder:"请输入数据源名称",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"数据源类型",prop:"type"},{default:o(()=>[a(h,{modelValue:l.value.type,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.type=e),placeholder:"请选择数据源类型",style:{width:"100%"},disabled:f.value},{default:o(()=>[(n(!0),g(F,null,B(p(z),e=>(n(),r(c,{key:e.value,label:e.label,value:e.value},{default:o(()=>[w("div",Q,[a(P,{class:"mr-2"},{default:o(()=>[e.value==="excel"||e.value==="csv"?(n(),r(p(G),{key:0})):e.value==="database"?(n(),r(p(I),{key:1})):(n(),r(p($),{key:2}))]),_:2},1024),m(" "+D(e.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(d,{label:"描述",prop:"description"},{default:o(()=>[a(i,{modelValue:l.value.description,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.description=e),type:"textarea",rows:3,placeholder:"请输入数据源描述（可选）"},null,8,["modelValue"])]),_:1}),l.value.type==="database"?(n(),g("div",Y,[a(U,{"content-position":"left"},{default:o(()=>[m("数据库连接配置")]),_:1}),(n(),g(F,null,B(N,e=>a(d,{key:e.key,label:e.label,prop:`config.${e.key}`,rules:p(K)[e.key]},{default:o(()=>[a(i,{modelValue:l.value.config[e.key],"onUpdate:modelValue":y=>l.value.config[e.key]=y,type:e.type||"text",placeholder:e.placeholder,clearable:""},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])]),_:2},1032,["label","prop","rules"])),64))])):v("",!0),["excel","csv","json"].includes(l.value.type)?(n(),g("div",J,[a(U,{"content-position":"left"},{default:o(()=>[m("文件配置")]),_:1}),a(d,{label:"文件路径"},{default:o(()=>[a(i,{modelValue:l.value.config.filePath,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.config.filePath=e),placeholder:"请输入文件路径或上传文件",clearable:""},{append:o(()=>[a(x,{icon:p(q),onClick:t[3]||(t[3]=e=>{var y;return(y=C.value)==null?void 0:y.click()})},{default:o(()=>[m(" 选择文件 ")]),_:1},8,["icon"])]),_:1},8,["modelValue"]),w("input",{ref_key:"fileInput",ref:C,type:"file",style:{display:"none"},accept:l.value.type==="excel"?".xlsx,.xls":l.value.type==="csv"?".csv":".json",onChange:E},null,40,M)]),_:1}),l.value.type==="csv"?(n(),r(d,{key:0,label:"编码格式"},{default:o(()=>[a(h,{modelValue:l.value.config.encoding,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.config.encoding=e),placeholder:"请选择编码格式",style:{width:"100%"}},{default:o(()=>[a(c,{label:"UTF-8",value:"utf-8"}),a(c,{label:"GBK",value:"gbk"}),a(c,{label:"GB2312",value:"gb2312"})]),_:1},8,["modelValue"])]),_:1})):v("",!0),l.value.type==="csv"?(n(),r(d,{key:1,label:"分隔符"},{default:o(()=>[a(h,{modelValue:l.value.config.delimiter,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.config.delimiter=e),placeholder:"请选择分隔符",style:{width:"100%"}},{default:o(()=>[a(c,{label:"逗号 (,)",value:","}),a(c,{label:"分号 (;)",value:";"}),a(c,{label:"制表符",value:"\\t"})]),_:1},8,["modelValue"])]),_:1})):v("",!0),["excel","csv"].includes(l.value.type)?(n(),r(d,{key:2,label:"包含表头"},{default:o(()=>[a(T,{modelValue:l.value.config.hasHeader,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.config.hasHeader=e)},null,8,["modelValue"])]),_:1})):v("",!0)])):v("",!0)]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}});export{oe as _};
