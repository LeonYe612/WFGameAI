import{s as R}from"./request-6dd7bfdd.js";import{r,M as B}from"./index-c3bc70ba.js";function L(a){const T=a.listApi,x=a.delApi,y=a.expandAll||!0,c=a.editRef,p=a.treeTableRef,u=r([]),f=r(!1),A=r(y),d=r(null);async function s(e){await R({apiFunc:T,onBeforeRequest:()=>{f.value=!1},onSucceed:t=>{u.value=t},onCompleted:()=>{f.value=!1,typeof e=="function"&&e(u.value)}})}async function b(e){var n;const t=(n=d.value)==null?void 0:n.id;await s(e),E(t)}function D(e){c.value.fetchData(),e.id?c.value.showEdit(e):c.value.showEdit()}function I(e){e.id&&(c.value.fetchData(),c.value.showEditWithParent(e.id))}async function M(e){await R({apiFunc:x,apiParams:{id:e.id},enableSucceedMsg:!0,succeedMsgContent:"删除成功！",onSucceed:()=>{s()}})}function m(e,t){var i;const n=(e==null?void 0:e.length)||0;for(let l=0;l<n;l++)p.value.toggleRowExpansion(e[l],t),(i=e[l].children)!=null&&i.length&&m(e[l].children,t)}function P(e){m(u.value,e)}function h(e){var t;(t=p.value)==null||t.setCurrentRow(e)}function C(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id==t)return i;if(i.children&&i.children.length>0){const l=C(i.children,t);if(l)return l}}return null}function E(e){if(!e){h();return}const t=C(u.value,e);t&&B(()=>{h(t)})}return{dataList:u,loading:f,defaultExpandAll:A,currentRow:d,recordCurrentChange:e=>{d.value=e},handleEdit:D,handleEditChild:I,handleDelete:M,fetchData:s,fetchDataWithMemoryCurrent:b,toggleTableExpansion:P,setCurrent:h,autoSetCurrent:E,getItemPathById:(e,t)=>{const n=[],i=(l,g)=>{const S=l.length;for(let v=0;v<S;v++){const o=l[v];if(n.push(o),o.id===g)return;o.children&&o.children.length>0&&i(o.children,g),n[n.length-1].id!==g&&n.pop()}};return i(e.value,t),n}}}export{L as useTreeTable};
