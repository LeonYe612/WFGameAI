import{u as I,d as q,m as E}from"./index-0964a6d0.js";import{i as de,b as ue}from"./scripts-8ebe9156.js";import{s as T}from"./request-28f7529e.js";import{m as re,r as p,d as W,A as r,O as ce,j as i,u as V,I as t,l,z as a,B as b,x as v,y as _,R as y,P as pe,k as m,F as N,p as z,aE as f,_ as me}from"./index-41f05ddf.js";const ve={class:"script-import-content"},_e={class:"space-y-4"},fe={class:"upload-content"},ge={key:0,class:"selected-file"},be={class:"flex items-center justify-between"},ye={class:"flex items-center"},xe={class:"font-medium"},he={class:"text-sm text-gray-500"},we={key:1,class:"script-info"},ke={class:"space-y-4"},Fe={class:"space-y-4"},Ve={class:"upload-content"},Se={key:0,class:"file-list"},Ce={class:"flex items-center justify-between"},Be={class:"font-medium"},De={class:"space-y-2 max-h-60 overflow-y-auto"},je={class:"flex items-center"},Ie={class:"text-sm font-medium"},Ne={class:"text-xs text-gray-500"},ze={key:1,class:"upload-progress"},Me={class:"flex justify-end space-x-2"},Oe=re({name:"ScriptImportDialog",__name:"scriptImportDialog",props:{categories:{}},emits:["imported"],setup(Ue,{expose:A,emit:K}){const M=K,S=p(!1),x=p("single"),n=p(!1),c=p(null),h=p(""),w=p(""),u=p([]),k=p(""),F=p(0),L=()=>{O(),S.value=!0},O=()=>{c.value=null,h.value="",w.value="",u.value=[],k.value="",F.value=0,x.value="single"},G=s=>s.name.endsWith(".json")?(c.value=s,!1):(f("请选择JSON格式的脚本文件",{type:"warning"}),!1),H=s=>{const e=s.filter(d=>d.name.endsWith(".json"));if(e.length===0){f("请选择JSON格式的脚本文件",{type:"warning"});return}u.value=e.map(d=>({file:d,status:"pending"}))},Q=()=>{c.value=null},X=s=>{u.value.splice(s,1)},Y=()=>{u.value=[]},U=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(2)+" KB":(s/(1024*1024)).toFixed(2)+" MB",Z=async()=>{if(!c.value){f("请选择要导入的脚本文件",{type:"warning"});return}const s=new FormData;s.append("file",c.value),h.value&&s.append("category",h.value),w.value&&s.append("description",w.value),await T({apiFunc:de,apiParams:s,enableSucceedMsg:!0,succeedMsgContent:"脚本导入成功！",onBeforeRequest:()=>{n.value=!0},onSucceed:()=>{M("imported"),C()},onFailed:()=>{f("脚本导入失败",{type:"error"})},onCompleted:()=>{n.value=!1}})},ee=async()=>{if(u.value.length===0){f("请选择要导入的脚本文件",{type:"warning"});return}const s=new FormData;u.value.forEach((e,d)=>{s.append("files",e.file)}),k.value&&s.append("category",k.value),await T({apiFunc:ue,apiParams:s,enableSucceedMsg:!0,succeedMsgContent:"批量导入完成！",onBeforeRequest:()=>{n.value=!0,F.value=0},onSucceed:e=>{const{success_count:d,total_count:B}=e;f(`成功导入 ${d}/${B} 个脚本`,{type:d>0?"success":"warning"}),M("imported"),C()},onFailed:()=>{f("批量导入失败",{type:"error"})},onCompleted:()=>{n.value=!1,F.value=100}})},C=()=>{S.value=!1,O()},le=W(()=>c.value!==null),te=W(()=>u.value.length>0);return A({showDialog:L}),(s,e)=>{const d=r("el-icon"),B=r("el-upload"),g=r("el-button"),D=r("el-card"),J=r("el-option"),P=r("el-select"),ae=r("el-input"),R=r("el-tab-pane"),se=r("el-progress"),oe=r("el-tabs"),ne=r("el-dialog"),ie=ce("loading");return i(),V(ne,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=o=>S.value=o),title:"导入脚本",width:"800px",draggable:!0,onClose:C},{footer:t(()=>[l("div",Me,[a(g,{onClick:C,disabled:n.value},{default:t(()=>[...e[15]||(e[15]=[b(" 取消 ",-1)])]),_:1},8,["disabled"]),x.value==="single"?(i(),V(g,{key:0,type:"primary",icon:v(I),loading:n.value,disabled:!le.value,onClick:Z},{default:t(()=>[b(_(n.value?"导入中...":"导入脚本"),1)]),_:1},8,["icon","loading","disabled"])):y("",!0),x.value==="batch"?(i(),V(g,{key:1,type:"primary",icon:v(I),loading:n.value,disabled:!te.value,onClick:ee},{default:t(()=>[b(_(n.value?"导入中...":`批量导入 (${u.value.length})`),1)]),_:1},8,["icon","loading","disabled"])):y("",!0)])]),default:t(()=>[pe((i(),m("div",ve,[a(oe,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=o=>x.value=o),class:"import-tabs"},{default:t(()=>[a(R,{label:"单文件导入",name:"single"},{default:t(()=>[l("div",_e,[a(B,{class:"upload-demo",drag:"","show-file-list":!1,"before-upload":G,accept:".json",disabled:n.value},{default:t(()=>[l("div",fe,[a(d,{class:"text-4xl text-gray-400 mb-4"},{default:t(()=>[a(v(I))]),_:1}),e[5]||(e[5]=l("div",{class:"text-gray-600"},[l("p",{class:"text-lg mb-2"},"点击或拖拽JSON文件到此区域"),l("p",{class:"text-sm text-gray-500"}," 支持单个.json格式的脚本文件 ")],-1))])]),_:1},8,["disabled"]),c.value?(i(),m("div",ge,[a(D,{shadow:"never",class:"border"},{default:t(()=>[l("div",be,[l("div",ye,[a(d,{class:"text-primary mr-2"},{default:t(()=>[a(v(q))]),_:1}),l("div",null,[l("div",xe,_(c.value.name),1),l("div",he,_(U(c.value.size)),1)])]),a(g,{size:"small",type:"danger",icon:v(E),onClick:Q,disabled:n.value},{default:t(()=>[...e[6]||(e[6]=[b(" 移除 ",-1)])]),_:1},8,["icon","disabled"])])]),_:1})])):y("",!0),c.value?(i(),m("div",we,[a(D,{shadow:"never",class:"border"},{header:t(()=>[...e[7]||(e[7]=[l("span",{class:"font-medium"},"脚本信息",-1)])]),default:t(()=>[l("div",ke,[l("div",null,[e[8]||(e[8]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 脚本分类 ",-1)),a(P,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=o=>h.value=o),placeholder:"请选择分类（可选）",style:{width:"100%"},clearable:"",disabled:n.value},{default:t(()=>[(i(!0),m(N,null,z(s.categories,o=>(i(),V(J,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),l("div",null,[e[9]||(e[9]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 脚本描述 ",-1)),a(ae,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),type:"textarea",rows:3,placeholder:"请输入脚本描述（可选）",disabled:n.value},null,8,["modelValue","disabled"])])])]),_:1})])):y("",!0)])]),_:1}),a(R,{label:"批量导入",name:"batch"},{default:t(()=>[l("div",Fe,[a(B,{class:"upload-demo",drag:"",multiple:"","show-file-list":!1,"on-change":(o,j)=>H(j.map($=>$.raw)),accept:".json",disabled:n.value},{default:t(()=>[l("div",Ve,[a(d,{class:"text-4xl text-gray-400 mb-4"},{default:t(()=>[a(v(I))]),_:1}),e[10]||(e[10]=l("div",{class:"text-gray-600"},[l("p",{class:"text-lg mb-2"},"点击或拖拽多个JSON文件到此区域"),l("p",{class:"text-sm text-gray-500"}," 支持批量上传.json格式的脚本文件 ")],-1))])]),_:1},8,["on-change","disabled"]),u.value.length>0?(i(),m("div",Se,[a(D,{shadow:"never",class:"border"},{header:t(()=>[l("div",Ce,[l("span",Be," 已选择 "+_(u.value.length)+" 个文件 ",1),a(g,{size:"small",type:"danger",onClick:Y,disabled:n.value},{default:t(()=>[...e[11]||(e[11]=[b(" 清空列表 ",-1)])]),_:1},8,["disabled"])])]),default:t(()=>[l("div",De,[(i(!0),m(N,null,z(u.value,(o,j)=>(i(),m("div",{key:j,class:"flex items-center justify-between p-2 bg-gray-50 rounded"},[l("div",je,[a(d,{class:"text-primary mr-2"},{default:t(()=>[a(v(q))]),_:1}),l("div",null,[l("div",Ie,_(o.file.name),1),l("div",Ne,_(U(o.file.size)),1)])]),a(g,{size:"small",type:"danger",icon:v(E),onClick:$=>X(j),disabled:n.value},{default:t(()=>[...e[12]||(e[12]=[b(" 移除 ",-1)])]),_:1},8,["icon","onClick","disabled"])]))),128))])]),_:1}),a(D,{shadow:"never",class:"border"},{header:t(()=>[...e[13]||(e[13]=[l("span",{class:"font-medium"},"批量设置",-1)])]),default:t(()=>[l("div",null,[e[14]||(e[14]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 统一分类 ",-1)),a(P,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=o=>k.value=o),placeholder:"为所有脚本设置统一分类（可选）",style:{width:"100%"},clearable:"",disabled:n.value},{default:t(()=>[(i(!0),m(N,null,z(s.categories,o=>(i(),V(J,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]),_:1})])):y("",!0),n.value&&F.value>0?(i(),m("div",ze,[a(se,{percentage:F.value,"stroke-width":8,status:"success"},null,8,["percentage"])])):y("",!0)])]),_:1})]),_:1},8,["modelValue"])])),[[ie,n.value]])]),_:1},8,["modelValue"])}}});const qe=me(Oe,[["__scopeId","data-v-91be2146"]]);export{qe as default};
