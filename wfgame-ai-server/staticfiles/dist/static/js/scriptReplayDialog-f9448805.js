import{J as D,p as L,m as O}from"./index-ccf167da.js";import{r as T}from"./scripts-d29b0ea0.js";import{s as G}from"./request-2aeceb02.js";import{m as H,r as f,d as K,A as u,O as Q,j as p,u as b,I as t,l,z as d,B as c,y as v,x as g,P as W,k as x,F as S,p as R,R as U,aE as j,_ as X}from"./index-fbbdd03e.js";const Y={class:"script-replay-content"},Z={class:"space-y-4"},ee={class:"flex items-center justify-between"},le={class:"flex items-center"},te={class:"space-y-4"},ae={class:"flex items-center justify-between mb-3"},se={class:"font-medium text-gray-700"},oe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ne={class:"flex justify-between items-center"},de={class:"mt-6 p-4 bg-blue-50 rounded-lg"},ie={class:"flex items-center space-x-4"},re={class:"bg-gray-100 p-3 rounded-lg font-mono text-sm"},ue={class:"flex justify-end space-x-2"},me=H({name:"ScriptReplayDialog",__name:"scriptReplayDialog",props:{scripts:{}},setup(pe,{expose:B}){const y=f(!1),n=f(!1),w=f(null),_=f(!0),i=f([]),N=a=>{w.value=a||null,a?i.value=[{script_filename:a.filename,delay:0,loop:1}]:i.value=[{script_filename:"",delay:0,loop:1}],y.value=!0},$=()=>{i.value.push({script_filename:"",delay:0,loop:1})},z=a=>{i.value.length>1&&i.value.splice(a,1)},F=K(()=>{const a=i.value.filter(s=>s.script_filename);return a.length===0?"请先选择要回放的脚本":`回放脚本: ${a.map(s=>{let m=s.script_filename;return s.delay&&s.delay>0&&(m+=` (延迟: ${s.delay}ms)`),s.loop&&s.loop>1&&(m+=` (循环: ${s.loop}次)`),m}).join(", ")}${_.value?" --show-screens":""}`}),P=async()=>{const a=i.value.filter(s=>s.script_filename);if(a.length===0){j("请至少选择一个脚本进行回放",{type:"warning"});return}const e={scripts:a,show_screens:_.value};await G({apiFunc:T,apiParams:e,enableSucceedMsg:!0,succeedMsgContent:"脚本回放已开始执行！",onBeforeRequest:()=>{n.value=!0},onSucceed:()=>{V()},onFailed:()=>{j("脚本回放启动失败",{type:"error"})},onCompleted:()=>{n.value=!1}})},V=()=>{y.value=!1,w.value=null,i.value=[],_.value=!0};return B({showDialog:N}),(a,e)=>{const s=u("el-icon"),m=u("el-button"),q=u("el-tag"),E=u("el-option"),I=u("el-select"),C=u("el-input-number"),M=u("el-checkbox"),h=u("el-card"),A=u("el-dialog"),J=Q("loading");return p(),b(A,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=r=>y.value=r),title:"脚本回放",width:"800px",draggable:!0,onClose:V},{footer:t(()=>[l("div",ue,[d(m,{onClick:V,disabled:n.value},{default:t(()=>[...e[11]||(e[11]=[c(" 取消 ",-1)])]),_:1},8,["disabled"]),d(m,{type:"primary",icon:g(D),loading:n.value,onClick:P},{default:t(()=>[c(v(n.value?"启动中...":"开始回放"),1)]),_:1},8,["icon","loading"])])]),default:t(()=>[W((p(),x("div",Y,[l("div",Z,[d(h,{shadow:"never",class:"border"},{header:t(()=>[l("div",ee,[l("div",le,[d(s,{class:"mr-2"},{default:t(()=>[d(g(D))]),_:1}),e[2]||(e[2]=l("span",{class:"font-medium"},"回放配置",-1))]),d(m,{size:"small",type:"primary",icon:g(L),onClick:$,disabled:n.value},{default:t(()=>[...e[3]||(e[3]=[c(" 添加脚本 ",-1)])]),_:1},8,["icon","disabled"])])]),default:t(()=>[l("div",te,[(p(!0),x(S,null,R(i.value,(r,k)=>(p(),x("div",{key:k,class:"script-config p-4 bg-gray-50 rounded-lg"},[l("div",ae,[l("span",se,"脚本 "+v(k+1),1),i.value.length>1?(p(),b(m,{key:0,size:"small",type:"danger",icon:g(O),onClick:o=>z(k),disabled:n.value},{default:t(()=>[...e[4]||(e[4]=[c(" 移除 ",-1)])]),_:1},8,["icon","onClick","disabled"])):U("",!0)]),l("div",oe,[l("div",null,[e[5]||(e[5]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 选择脚本 * ",-1)),d(I,{modelValue:r.script_filename,"onUpdate:modelValue":o=>r.script_filename=o,placeholder:"请选择脚本",style:{width:"100%"},filterable:"",disabled:n.value},{default:t(()=>[(p(!0),x(S,null,R(a.scripts,o=>(p(),b(E,{key:o.filename,label:o.filename,value:o.filename},{default:t(()=>[l("div",ne,[l("span",null,v(o.filename),1),o.category?(p(),b(q,{key:0,type:"info",size:"small"},{default:t(()=>[c(v(o.category),1)]),_:2},1024)):U("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])]),l("div",null,[e[6]||(e[6]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 延迟时间 (毫秒) ",-1)),d(C,{modelValue:r.delay,"onUpdate:modelValue":o=>r.delay=o,min:0,max:1e4,style:{width:"100%"},disabled:n.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),l("div",null,[e[7]||(e[7]=l("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 循环次数 ",-1)),d(C,{modelValue:r.loop,"onUpdate:modelValue":o=>r.loop=o,min:1,max:100,style:{width:"100%"},disabled:n.value},null,8,["modelValue","onUpdate:modelValue","disabled"])])])]))),128))]),l("div",de,[e[9]||(e[9]=l("h4",{class:"text-sm font-medium text-gray-700 mb-3"},"全局设置",-1)),l("div",ie,[d(M,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=r=>_.value=r),disabled:n.value},{default:t(()=>[...e[8]||(e[8]=[c(" 显示屏幕截图 ",-1)])]),_:1},8,["modelValue","disabled"])])])]),_:1}),d(h,{shadow:"never",class:"border"},{header:t(()=>[...e[10]||(e[10]=[l("span",{class:"font-medium"},"命令预览",-1)])]),default:t(()=>[l("div",re,v(F.value),1)]),_:1})])])),[[J,n.value]])]),_:1},8,["modelValue"])}}});const ye=X(me,[["__scopeId","data-v-0ad850fa"]]);export{ye as default};
