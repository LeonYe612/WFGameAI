import{g as re,A as ce,z as ie,k as de,m as pe}from"./index-52ed101c.js";import{s as _e,t as k,a as ue,e as me}from"./enums-d2c4bc7a.js";import{a_ as ge,aF as P,l as fe,r as x,$,o as he,z as o,N as ye,h as p,j as T,y as a,H as l,F as ke,m as ve,q as h,v as s,A as _,O as we,x as u,k as m,Q as C,_ as be}from"./index-c3bc70ba.js";import{useNavigate as Ce}from"./navHook-8958b211.js";import{useOcr as De}from"./hook-4ab85b30.js";import"./ocr-2eff45aa.js";import"./request-6dd7bfdd.js";const ze=v=>{ge(v)?P(`${v} 已复制到系统剪切板`,{type:"success"}):P("复制到系统剪切板失败",{type:"error"})},xe={class:"flex-full flex-col gap-2"},Te={class:"source-info"},Ve={key:2};const Se={class:"creation-info"},Be={class:"creator"},Ne={class:"create-time"},Ee={class:"pagination-wrapper"};const Oe=fe({__name:"OcrTaskHistory",props:{fetchData:{type:Function}},emits:["view-task","view-results","download","delete","create-task","data-loaded"],setup(v,{expose:V,emit:g}){const F=v,{navigateToOcrResult:I}=Ce(),{deleteTask:L,downloadTask:H}=De(),w=x(!1),b=x([]),D=x(null),S={startDate:"",endDate:"",status:""},c=$({...S}),n=$({currentPage:1,pageSize:20,total:0}),B=t=>t.status===k.COMPLETED.value||t.status===k.FAILED.value,i=async()=>{w.value=!1;try{const t={...c,page:n.currentPage,page_size:n.pageSize},d=await F.fetchData(t);b.value=d.data.tasks||[],n.total=d.data.total||0,g("data-loaded",d)}catch(t){console.error("Failed to fetch table data:",t),b.value=[],n.total=0}finally{w.value=!1}},R=()=>{n.currentPage=1,i()},j=()=>{Object.assign(c,S),D.value=null,n.currentPage=1,i()},A=t=>{n.currentPage=t,i()},U=t=>{n.pageSize=t,n.currentPage=1,i()},M=t=>t.source_type==="git"?`${t.git_repository_url} (${t.git_branch})`:"用户自定义上传",q=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",G=t=>{t?(c.startDate=t[0].toISOString().split("T")[0],c.endDate=t[1].toISOString().split("T")[0]):(c.startDate="",c.endDate=""),i()},Q=t=>{ze(t.id),g("view-task",t)},J=t=>{g("view-results",t),I(t.id)},K=t=>{H(t.id),g("download",t)},W=t=>{L(t.id).then(()=>{i(),g("delete",t)})},Pe=()=>{g("create-task")},X=()=>{i()};return he(()=>{i()}),V({refresh:X}),(t,d)=>{const Y=o("el-option"),Z=o("el-select"),z=o("el-form-item"),ee=o("el-date-picker"),y=o("el-button"),te=o("el-form"),N=o("el-card"),ae=o("el-link"),r=o("el-table-column"),E=o("el-tag"),O=o("el-progress"),le=o("el-popconfirm"),oe=o("el-table"),ne=o("el-pagination"),$e=o("el-empty"),se=ye("loading");return p(),T("div",xe,[a(N,{class:"filter-card"},{default:l(()=>[a(te,{model:c,inline:""},{default:l(()=>[a(z,{label:"状态"},{default:l(()=>[a(Z,{modelValue:c.status,"onUpdate:modelValue":d[0]||(d[0]=e=>c.status=e),placeholder:"所有状态",clearable:"",style:{width:"120px"},onChange:i},{default:l(()=>[(p(!0),T(ke,null,ve(s(_e)(s(k)),e=>(p(),h(Y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(z,{label:"时间范围"},{default:l(()=>[a(ee,{modelValue:D.value,"onUpdate:modelValue":d[1]||(d[1]=e=>D.value=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"},onChange:G},null,8,["modelValue"])]),_:1}),a(z,null,{default:l(()=>[a(y,{icon:s(re),type:"primary",onClick:R,plain:""},{default:l(()=>[_(" 搜索 ")]),_:1},8,["icon"]),a(y,{icon:s(ce),onClick:j},{default:l(()=>[_(" 重置 ")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),a(N,{class:"table-card"},{default:l(()=>[we((p(),h(oe,{data:b.value,stripe:"",style:{width:"100%"},height:"100%"},{default:l(()=>[a(r,{prop:"id",label:"任务ID",width:"220"},{default:l(({row:e})=>[a(ae,{type:"primary",onClick:f=>Q(e)},{default:l(()=>[_(u(e.id),1)]),_:2},1032,["onClick"])]),_:1}),a(r,{prop:"source",label:"数据来源","min-width":"200","show-overflow-tooltip":""},{default:l(({row:e})=>[m("div",Te,[a(E,{type:e.source_type==="git"?"success":"warning",size:"small",class:"source-type-tag"},{default:l(()=>[_(u(e.source_type==="git"?"Git":"Upload"),1)]),_:2},1032,["type"]),m("span",null,u(M(e)),1)])]),_:1}),a(r,{prop:"status",label:"状态",width:"100"},{default:l(({row:e})=>{var f;return[a(E,{type:(f=s(ue)(s(k),e.status))==null?void 0:f.type,size:"small"},{default:l(()=>[_(u(s(me)(s(k),e.status)),1)]),_:2},1032,["type"])]}),_:1}),a(r,{prop:"progress",label:"进度",width:"180"},{default:l(({row:e})=>[e.status==="running"?(p(),h(O,{key:0,percentage:e.progress||0,"stroke-width":10,striped:"","striped-flow":""},null,8,["percentage"])):e.status==="completed"?(p(),h(O,{key:1,percentage:100,status:"success","stroke-width":10})):(p(),T("span",Ve,"-"))]),_:1}),a(r,{prop:"duration",label:"耗时",width:"120"},{default:l(({row:e})=>[_(u(e.duration||"-"),1)]),_:1}),a(r,{prop:"total_images",label:"图片总数",width:"100"}),a(r,{prop:"matched_images",label:"命中数",width:"100"}),a(r,{prop:"match_rate",label:"匹配率",width:"100",align:"center"},{default:l(({row:e})=>[m("span",null,u(`${e.match_rate}%`),1)]),_:1}),C("",!0),a(r,{prop:"created_at",label:"创建信息",width:"180"},{default:l(({row:e})=>[m("div",Se,[m("span",Be,u(e.creator_username||"未知"),1),m("span",Ne,u(q(e.created_at)),1)])]),_:1}),a(r,{label:"操作",fixed:"right",width:280},{default:l(({row:e})=>[B(e)?(p(),h(y,{key:0,type:"primary",size:"small",plain:"",icon:s(ie),onClick:f=>J(e)},{default:l(()=>[_(" 查看 ")]),_:2},1032,["icon","onClick"])):C("",!0),B(e)?(p(),h(y,{key:1,type:"warning",size:"small",plain:"",icon:s(de),onClick:f=>K(e)},{default:l(()=>[_(" 下载 ")]),_:2},1032,["icon","onClick"])):C("",!0),a(le,{title:"是否确认删除?",onConfirm:f=>W(e)},{reference:l(()=>[a(y,{type:"danger",size:"small",plain:"",icon:s(pe)},{default:l(()=>[_(" 删除 ")]),_:1},8,["icon"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[se,w.value]]),m("div",Ee,[a(ne,{"current-page":n.currentPage,"page-size":n.pageSize,total:n.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:A},null,8,["current-page","page-size","total"])]),(!w.value&&b.value.length,C("",!0))]),_:1})])}}});const Ue=be(Oe,[["__scopeId","data-v-004e2e36"]]);export{Ue as default};
