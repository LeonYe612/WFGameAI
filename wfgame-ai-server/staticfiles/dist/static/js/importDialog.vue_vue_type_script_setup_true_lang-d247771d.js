import{u as H,k as M}from"./index-ccf167da.js";import{i as T}from"./rules-a40408e3.js";import{m as E,r as V,d as N,A as u,j as f,u as y,I as a,l as i,z as l,B as v,x as w,k as W,p as S,F as z,R as G,aP as k}from"./index-fbbdd03e.js";const O={class:"flex justify-end space-x-2"},J=E({name:"ImportDialog",__name:"importDialog",props:{modelValue:{type:Boolean},dataSources:{}},emits:["update:modelValue","import"],setup(q,{emit:U}){const C=U,m=V(),r=V([]),o=V({sourceId:"",encoding:"utf-8",delimiter:",",hasHeader:!0}),_=N(()=>r.value.length>0?r.value[0]:null),b=()=>{var t;C("update:modelValue",!1),(t=m.value)==null||t.resetFields(),r.value=[]},L=t=>t.type.includes("excel")||t.type.includes("csv")||t.name.endsWith(".xlsx")||t.name.endsWith(".xls")||t.name.endsWith(".csv")?(t.size/1024/1024<10||k.error("文件大小不能超过 10MB！"),!1):(k.error("只能上传 Excel 或 CSV 文件！"),!1),h=(t,e)=>{r.value=e.slice(-1)},F=async()=>{if(m.value){if(!_.value){k.error("请选择要导入的文件");return}try{await m.value.validate();const t={file:_.value.raw,sourceId:o.value.sourceId||void 0,encoding:o.value.encoding,delimiter:o.value.delimiter,hasHeader:o.value.hasHeader};C("import",t),b()}catch(t){console.error("表单验证失败:",t)}}},I=()=>{const e=[["字段1","字段2","字段3"],["示例数据1","示例数据2","示例数据3"],["示例数据4","示例数据5","示例数据6"]].map(d=>d.join(",")).join(`
`),p=new Blob([e],{type:"text/csv;charset=utf-8;"}),c=window.URL.createObjectURL(p),s=document.createElement("a");s.href=c,s.download="data_template.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(c)};return(t,e)=>{const p=u("el-icon"),c=u("el-upload"),s=u("el-form-item"),d=u("el-option"),x=u("el-select"),R=u("el-switch"),g=u("el-button"),D=u("el-form"),j=u("el-dialog");return f(),y(j,{"model-value":t.modelValue,title:"导入数据",width:"600px",draggable:!0,onClose:b},{footer:a(()=>[i("div",O,[l(g,{onClick:b},{default:a(()=>[...e[10]||(e[10]=[v("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:F},{default:a(()=>[...e[11]||(e[11]=[v(" 开始导入 ",-1)])]),_:1})])]),default:a(()=>[l(D,{ref_key:"formRef",ref:m,model:o.value,rules:w(T),"label-width":"100px","label-position":"left"},{default:a(()=>{var B;return[l(s,{label:"选择文件",required:""},{default:a(()=>[l(c,{"file-list":r.value,"onUpdate:fileList":e[0]||(e[0]=n=>r.value=n),drag:"","auto-upload":!1,"before-upload":L,"on-change":h,limit:1,accept:".xlsx,.xls,.csv",class:"w-full"},{tip:a(()=>[...e[5]||(e[5]=[i("div",{class:"el-upload__tip"}," 支持 .xlsx/.xls/.csv 文件，且不超过 10MB ",-1)])]),default:a(()=>[l(p,{class:"el-icon--upload"},{default:a(()=>[l(w(H))]),_:1}),e[6]||(e[6]=i("div",{class:"el-upload__text"},[v("将文件拖到此处，或"),i("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1}),l(s,{label:"目标数据源"},{default:a(()=>[l(x,{modelValue:o.value.sourceId,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.sourceId=n),placeholder:"选择已有数据源或留空创建新数据源",style:{width:"100%"},clearable:""},{default:a(()=>[(f(!0),W(z,null,S(t.dataSources,n=>(f(),y(d,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[7]||(e[7]=i("div",{class:"text-xs text-gray-500 mt-1"}," 留空将根据文件名创建新的数据源 ",-1))]),_:1}),l(s,{label:"文件编码",prop:"encoding"},{default:a(()=>[l(x,{modelValue:o.value.encoding,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.encoding=n),placeholder:"请选择文件编码",style:{width:"100%"}},{default:a(()=>[l(d,{label:"UTF-8",value:"utf-8"}),l(d,{label:"GBK",value:"gbk"}),l(d,{label:"GB2312",value:"gb2312"})]),_:1},8,["modelValue"])]),_:1}),(B=_.value)!=null&&B.name.endsWith(".csv")?(f(),y(s,{key:0,label:"分隔符"},{default:a(()=>[l(x,{modelValue:o.value.delimiter,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.delimiter=n),placeholder:"请选择分隔符",style:{width:"100%"}},{default:a(()=>[l(d,{label:"逗号 (,)",value:","}),l(d,{label:"分号 (;)",value:";"}),l(d,{label:"制表符",value:"\\t"})]),_:1},8,["modelValue"])]),_:1})):G("",!0),l(s,{label:"包含表头"},{default:a(()=>[l(R,{modelValue:o.value.hasHeader,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.hasHeader=n)},null,8,["modelValue"]),e[8]||(e[8]=i("div",{class:"text-xs text-gray-500 ml-2"},"文件第一行是否为字段名",-1))]),_:1}),l(s,null,{default:a(()=>[l(g,{icon:w(M),type:"info",plain:"",onClick:I},{default:a(()=>[...e[9]||(e[9]=[v(" 下载模板文件 ",-1)])]),_:1},8,["icon"])]),_:1})]}),_:1},8,["model","rules"])]),_:1},8,["model-value"])}}});export{J as _};
