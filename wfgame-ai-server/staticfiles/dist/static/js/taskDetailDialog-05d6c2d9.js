import{J,N as q,i as F,r as H,n as K}from"./index-0964a6d0.js";import{T as z,g as M}from"./tasks-b16f8164.js";import{t as N,a as I}from"./rules-08a3868a.js";import{m as O,d as P,r as L,w as Q,A as d,j as i,u as k,I as e,l,z as a,B as u,x as o,R as b,k as v,y as r,v as S,_ as W}from"./index-41f05ddf.js";const X={key:0,class:"task-detail"},Y={class:"info-item"},Z={class:"info-item"},h={class:"info-item"},x={class:"info-item"},tt={class:"info-item"},st={class:"info-item"},et={key:0,class:"info-item full-width"},lt={class:"description"},at={class:"card-header"},ot={class:"logs-container"},nt={key:0,class:"logs-loading"},it={key:1,class:"logs-content"},dt={key:2,class:"logs-empty"},ut={class:"dialog-footer"},rt=O({__name:"taskDetailDialog",props:{visible:{type:Boolean,default:!1},task:{default:null},loading:{type:Boolean,default:!1}},emits:["update:visible","action"],setup(R,{emit:U}){const f=R,w=U,C=P({get:()=>f.visible,set:s=>w("update:visible",s)}),g=L(""),c=L(!1);Q(()=>f.task,s=>{s&&D()},{immediate:!0});const D=async()=>{if(f.task)try{c.value=!0;const s=await M(f.task.id);g.value=s.data||"暂无日志信息"}catch(s){console.error("加载日志失败:",s),g.value="加载日志失败"}finally{c.value=!1}},V=s=>{f.task&&w("action",s,f.task)},$=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"--";return(s,t)=>{const m=d("el-col"),p=d("el-icon"),A=d("el-tag"),G=d("el-row"),B=d("el-card"),y=d("el-button"),j=d("el-scrollbar"),E=d("el-dialog");return i(),k(E,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=n=>C.value=n),title:"任务详情",width:"800px","close-on-click-modal":!1},{footer:e(()=>[l("div",ut,[a(y,{onClick:t[0]||(t[0]=n=>C.value=!1)},{default:e(()=>[...t[15]||(t[15]=[u(" 关闭 ",-1)])]),_:1}),s.task&&s.task.status!==o(z).RUNNING?(i(),k(y,{key:0,type:"primary",onClick:t[1]||(t[1]=n=>V("start"))},{default:e(()=>[a(p,null,{default:e(()=>[a(o(J))]),_:1}),t[16]||(t[16]=u(" 启动任务 ",-1))]),_:1})):b("",!0),s.task&&s.task.status===o(z).RUNNING?(i(),k(y,{key:1,type:"danger",onClick:t[2]||(t[2]=n=>V("stop"))},{default:e(()=>[a(p,null,{default:e(()=>[a(o(q))]),_:1}),t[17]||(t[17]=u(" 停止任务 ",-1))]),_:1})):b("",!0)])]),default:e(()=>[s.task?(i(),v("div",X,[a(B,{class:"info-card",shadow:"never"},{header:e(()=>[...t[4]||(t[4]=[l("div",{class:"card-header"},[l("span",null,"基本信息")],-1)])]),default:e(()=>[a(G,{gutter:24},{default:e(()=>[a(m,{span:12},{default:e(()=>[l("div",Y,[t[5]||(t[5]=l("label",null,"任务名称：",-1)),l("span",null,r(s.task.name),1)])]),_:1}),a(m,{span:12},{default:e(()=>{var n;return[l("div",Z,[t[6]||(t[6]=l("label",null,"任务状态：",-1)),a(A,{type:(n=o(N)[s.task.status])==null?void 0:n.type,size:"small"},{default:e(()=>{var _;return[a(p,{class:"status-icon"},{default:e(()=>{var T;return[(i(),k(S((T=o(N)[s.task.status])==null?void 0:T.icon)))]}),_:1}),u(" "+r((_=o(N)[s.task.status])==null?void 0:_.label),1)]}),_:1},8,["type"])])]}),_:1}),a(m,{span:12},{default:e(()=>{var n;return[l("div",h,[t[7]||(t[7]=l("label",null,"任务类型：",-1)),l("span",null,[a(p,null,{default:e(()=>{var _;return[(i(),k(S((_=o(I)[s.task.type])==null?void 0:_.icon)))]}),_:1}),u(" "+r((n=o(I)[s.task.type])==null?void 0:n.label),1)])])]}),_:1}),a(m,{span:12},{default:e(()=>[l("div",x,[t[8]||(t[8]=l("label",null,"目标设备：",-1)),l("span",null,[a(p,null,{default:e(()=>[a(o(F))]),_:1}),u(" "+r(s.task.device),1)])])]),_:1}),a(m,{span:12},{default:e(()=>[l("div",tt,[t[9]||(t[9]=l("label",null,"开始时间：",-1)),l("span",null,r($(s.task.startTime)),1)])]),_:1}),a(m,{span:12},{default:e(()=>[l("div",st,[t[10]||(t[10]=l("label",null,"执行耗时：",-1)),l("span",null,r(s.task.duration||"--"),1)])]),_:1})]),_:1}),s.task.description?(i(),v("div",et,[t[11]||(t[11]=l("label",null,"任务描述：",-1)),l("p",lt,r(s.task.description),1)])):b("",!0)]),_:1}),a(B,{class:"logs-card",shadow:"never"},{header:e(()=>[l("div",at,[t[13]||(t[13]=l("span",null,"执行日志",-1)),a(y,{size:"small",loading:c.value,onClick:D},{default:e(()=>[a(p,null,{default:e(()=>[a(o(H))]),_:1}),t[12]||(t[12]=u(" 刷新日志 ",-1))]),_:1},8,["loading"])])]),default:e(()=>[l("div",ot,[a(j,{height:"300px"},{default:e(()=>[c.value?(i(),v("div",nt,[a(p,{class:"is-loading"},{default:e(()=>[a(o(K))]),_:1}),t[14]||(t[14]=u(" 加载日志中... ",-1))])):g.value?(i(),v("pre",it,r(g.value),1)):(i(),v("div",dt,"暂无日志信息"))]),_:1})])]),_:1})])):b("",!0)]),_:1},8,["modelValue"])}}});const kt=W(rt,[["__scopeId","data-v-12389050"]]);export{kt as default};
