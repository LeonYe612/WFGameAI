import{d as D,n as U}from"./index-8ca571cf.js";import{g as A,s as H}from"./scripts-e54598c6.js";import{s as O}from"./request-d2ecd641.js";import{l as K,r,z as u,N as L,h as n,q as Q,H as s,k as e,y as o,A as f,x as _,v as k,O as $,j as c,Q as p,aF as g,aO as G,ah as W,ai as X,_ as Y}from"./index-e046f3d2.js";const d=y=>(W("data-v-302bce5b"),y=y(),X(),y),Z={class:"script-edit-content"},ee={key:0,class:"space-y-4"},te={class:"flex items-center justify-between"},ae={class:"flex items-center"},se=d(()=>e("span",{class:"font-medium"},"脚本信息",-1)),oe={class:"flex space-x-2"},le={class:"grid grid-cols-2 gap-4 text-sm mb-4"},ne=d(()=>e("span",{class:"text-gray-500"},"文件名: ",-1)),ie={class:"font-medium"},ce={key:0},de=d(()=>e("span",{class:"text-gray-500"},"分类: ",-1)),re={key:1},ue=d(()=>e("span",{class:"text-gray-500"},"文件大小: ",-1)),_e={key:2},pe=d(()=>e("span",{class:"text-gray-500"},"修改时间: ",-1)),ve={class:"script-editor"},me={class:"flex justify-between items-center mt-2 text-sm text-gray-500"},fe={key:0,class:"text-orange-500"},ge=d(()=>e("i",{class:"el-icon-warning-outline mr-1"},null,-1)),ye={key:1,class:"text-center py-12"},he=d(()=>e("p",{class:"text-gray-500"},"正在加载脚本内容...",-1)),xe={class:"flex justify-end space-x-2"},be=K({name:"ScriptEditDialog",__name:"scriptEditDialog",emits:["saved"],setup(y,{expose:J,emit:E}){const h=r(!1),v=r(!1),i=r(!1),t=r(null),a=r(""),m=r(""),F=async l=>{t.value=l,a.value="",m.value="",h.value=!0,await z()},z=async()=>{t.value&&await O({apiFunc:A,apiParams:t.value.filename,onBeforeRequest:()=>{v.value=!0},onSucceed:l=>{a.value=l.content||"",m.value=l.content||""},onFailed:()=>{g("加载脚本内容失败",{type:"error"})},onCompleted:()=>{v.value=!1}})},j=()=>{try{const l=JSON.parse(a.value);a.value=JSON.stringify(l,null,2),g("JSON格式化成功",{type:"success"})}catch{g("JSON格式错误，无法格式化",{type:"error"})}},q=async()=>{if(t.value){try{JSON.parse(a.value)}catch{g("JSON格式错误，请检查语法",{type:"error"});return}await O({apiFunc:H,apiParams:[t.value.filename,a.value],enableSucceedMsg:!0,succeedMsgContent:"脚本保存成功！",onBeforeRequest:()=>{i.value=!0},onSucceed:()=>{m.value=a.value,E("saved"),b()},onFailed:()=>{g("脚本保存失败",{type:"error"})},onCompleted:()=>{i.value=!1}})}},b=()=>{h.value=!1,t.value=null,a.value="",m.value=""},S=()=>a.value!==m.value,N=()=>{S()?G.confirm("脚本内容已修改但未保存，确定要关闭吗？","确认关闭",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b()}).catch(()=>{}):b()};return J({showDialog:F}),(l,x)=>{var B;const V=u("el-icon"),C=u("el-button"),I=u("el-tag"),M=u("el-input"),R=u("el-card"),T=u("el-dialog"),P=L("loading");return n(),Q(T,{modelValue:h.value,"onUpdate:modelValue":x[1]||(x[1]=w=>h.value=w),title:`编辑脚本 - ${((B=t.value)==null?void 0:B.filename)||""}`,width:"90%",draggable:!0,"before-close":N},{footer:s(()=>[e("div",xe,[o(C,{onClick:N,disabled:i.value},{default:s(()=>[f(" 取消 ")]),_:1},8,["disabled"]),o(C,{type:"primary",icon:k(D),loading:i.value,onClick:q,disabled:!S()},{default:s(()=>[f(_(i.value?"保存中...":"保存脚本"),1)]),_:1},8,["icon","loading","disabled"])])]),default:s(()=>[$((n(),c("div",Z,[!v.value&&t.value?(n(),c("div",ee,[o(R,{shadow:"never",class:"border"},{header:s(()=>[e("div",te,[e("div",ae,[o(V,{class:"mr-2"},{default:s(()=>[o(k(D))]),_:1}),se]),e("div",oe,[o(C,{size:"small",type:"info",onClick:j,disabled:i.value},{default:s(()=>[f(" 格式化JSON ")]),_:1},8,["disabled"])])])]),default:s(()=>[e("div",le,[e("div",null,[ne,e("span",ie,_(t.value.filename),1)]),t.value.category?(n(),c("div",ce,[de,o(I,{type:"info",size:"small"},{default:s(()=>[f(_(t.value.category),1)]),_:1})])):p("",!0),t.value.size?(n(),c("div",re,[ue,e("span",null,_((t.value.size/1024).toFixed(2))+" KB",1)])):p("",!0),t.value.modified_at?(n(),c("div",_e,[pe,e("span",null,_(new Date(t.value.modified_at).toLocaleString()),1)])):p("",!0)]),e("div",ve,[o(M,{modelValue:a.value,"onUpdate:modelValue":x[0]||(x[0]=w=>a.value=w),type:"textarea",rows:20,placeholder:"请输入脚本内容（JSON格式）",class:"font-mono",disabled:i.value},null,8,["modelValue","disabled"])]),e("div",me,[e("span",null,"字符数: "+_(a.value.length),1),S()?(n(),c("span",fe,[ge,f(" 内容已修改 ")])):p("",!0)])]),_:1})])):p("",!0),v.value?(n(),c("div",ye,[o(V,{class:"animate-spin text-4xl text-primary mb-4"},{default:s(()=>[o(k(U))]),_:1}),he])):p("",!0)])),[[P,v.value]])]),_:1},8,["modelValue","title"])}}});const Ne=Y(be,[["__scopeId","data-v-302bce5b"]]);export{Ne as default};
