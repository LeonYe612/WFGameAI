import{u as j,k as H}from"./index-52ed101c.js";import{i as M}from"./rules-809ac171.js";import{l as N,r as g,c as T,z as u,h as _,q as y,H as a,k as i,y as e,A as f,v as V,j as E,m as W,F as S,Q as q,aN as w}from"./index-c3bc70ba.js";const z=i("div",{class:"el-upload__text"},[f("将文件拖到此处，或"),i("em",null,"点击上传")],-1),G=i("div",{class:"el-upload__tip"}," 支持 .xlsx/.xls/.csv 文件，且不超过 10MB ",-1),O=i("div",{class:"text-xs text-gray-500 mt-1"}," 留空将根据文件名创建新的数据源 ",-1),A=i("div",{class:"text-xs text-gray-500 ml-2"},"文件第一行是否为字段名",-1),K={class:"flex justify-end space-x-2"},Y=N({name:"ImportDialog",__name:"importDialog",props:{modelValue:{type:Boolean},dataSources:{}},emits:["update:modelValue","import"],setup(Q,{emit:k}){const c=g(),r=g([]),o=g({sourceId:"",encoding:"utf-8",delimiter:",",hasHeader:!0}),v=T(()=>r.value.length>0?r.value[0]:null),b=()=>{var l;k("update:modelValue",!1),(l=c.value)==null||l.resetFields(),r.value=[]},U=l=>l.type.includes("excel")||l.type.includes("csv")||l.name.endsWith(".xlsx")||l.name.endsWith(".xls")||l.name.endsWith(".csv")?(l.size/1024/1024<10||w.error("文件大小不能超过 10MB！"),!1):(w.error("只能上传 Excel 或 CSV 文件！"),!1),B=(l,t)=>{r.value=t.slice(-1)},L=async()=>{if(c.value){if(!v.value){w.error("请选择要导入的文件");return}try{await c.value.validate();const l={file:v.value.raw,sourceId:o.value.sourceId||void 0,encoding:o.value.encoding,delimiter:o.value.delimiter,hasHeader:o.value.hasHeader};k("import",l),b()}catch(l){console.error("表单验证失败:",l)}}},F=()=>{const t=[["字段1","字段2","字段3"],["示例数据1","示例数据2","示例数据3"],["示例数据4","示例数据5","示例数据6"]].map(d=>d.join(",")).join(`
`),m=new Blob([t],{type:"text/csv;charset=utf-8;"}),p=window.URL.createObjectURL(m),s=document.createElement("a");s.href=p,s.download="data_template.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(p)};return(l,t)=>{const m=u("el-icon"),p=u("el-upload"),s=u("el-form-item"),d=u("el-option"),h=u("el-select"),D=u("el-switch"),x=u("el-button"),I=u("el-form"),R=u("el-dialog");return _(),y(R,{"model-value":l.modelValue,title:"导入数据",width:"600px",draggable:!0,onClose:b},{footer:a(()=>[i("div",K,[e(x,{onClick:b},{default:a(()=>[f("取消")]),_:1}),e(x,{type:"primary",onClick:L},{default:a(()=>[f(" 开始导入 ")]),_:1})])]),default:a(()=>[e(I,{ref_key:"formRef",ref:c,model:o.value,rules:V(M),"label-width":"100px","label-position":"left"},{default:a(()=>{var C;return[e(s,{label:"选择文件",required:""},{default:a(()=>[e(p,{"file-list":r.value,"onUpdate:fileList":t[0]||(t[0]=n=>r.value=n),drag:"","auto-upload":!1,"before-upload":U,"on-change":B,limit:1,accept:".xlsx,.xls,.csv",class:"w-full"},{tip:a(()=>[G]),default:a(()=>[e(m,{class:"el-icon--upload"},{default:a(()=>[e(V(j))]),_:1}),z]),_:1},8,["file-list"])]),_:1}),e(s,{label:"目标数据源"},{default:a(()=>[e(h,{modelValue:o.value.sourceId,"onUpdate:modelValue":t[1]||(t[1]=n=>o.value.sourceId=n),placeholder:"选择已有数据源或留空创建新数据源",style:{width:"100%"},clearable:""},{default:a(()=>[(_(!0),E(S,null,W(l.dataSources,n=>(_(),y(d,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),O]),_:1}),e(s,{label:"文件编码",prop:"encoding"},{default:a(()=>[e(h,{modelValue:o.value.encoding,"onUpdate:modelValue":t[2]||(t[2]=n=>o.value.encoding=n),placeholder:"请选择文件编码",style:{width:"100%"}},{default:a(()=>[e(d,{label:"UTF-8",value:"utf-8"}),e(d,{label:"GBK",value:"gbk"}),e(d,{label:"GB2312",value:"gb2312"})]),_:1},8,["modelValue"])]),_:1}),(C=v.value)!=null&&C.name.endsWith(".csv")?(_(),y(s,{key:0,label:"分隔符"},{default:a(()=>[e(h,{modelValue:o.value.delimiter,"onUpdate:modelValue":t[3]||(t[3]=n=>o.value.delimiter=n),placeholder:"请选择分隔符",style:{width:"100%"}},{default:a(()=>[e(d,{label:"逗号 (,)",value:","}),e(d,{label:"分号 (;)",value:";"}),e(d,{label:"制表符",value:"\\t"})]),_:1},8,["modelValue"])]),_:1})):q("",!0),e(s,{label:"包含表头"},{default:a(()=>[e(D,{modelValue:o.value.hasHeader,"onUpdate:modelValue":t[4]||(t[4]=n=>o.value.hasHeader=n)},null,8,["modelValue"]),A]),_:1}),e(s,null,{default:a(()=>[e(x,{icon:V(H),type:"info",plain:"",onClick:F},{default:a(()=>[f(" 下载模板文件 ")]),_:1},8,["icon"])]),_:1})]}),_:1},8,["model","rules"])]),_:1},8,["model-value"])}}});export{Y as _};
