import{u as z,d as T,m as W}from"./index-8ca571cf.js";import{i as ce,b as ue}from"./scripts-e54598c6.js";import{s as A}from"./request-d2ecd641.js";import{l as re,r as p,c as H,z as u,N as pe,h as i,q as V,H as l,k as e,y as a,A as h,v as _,x as v,Q as y,O as me,j as m,F as M,m as O,aF as f,ah as _e,ai as ve,_ as fe}from"./index-e046f3d2.js";const g=C=>(_e("data-v-91be2146"),C=C(),ve(),C),ge={class:"script-import-content"},be={class:"space-y-4"},he={class:"upload-content"},ye=g(()=>e("div",{class:"text-gray-600"},[e("p",{class:"text-lg mb-2"},"点击或拖拽JSON文件到此区域"),e("p",{class:"text-sm text-gray-500"}," 支持单个.json格式的脚本文件 ")],-1)),xe={key:0,class:"selected-file"},we={class:"flex items-center justify-between"},ke={class:"flex items-center"},Se={class:"font-medium"},Fe={class:"text-sm text-gray-500"},Ve={key:1,class:"script-info"},Ce=g(()=>e("span",{class:"font-medium"},"脚本信息",-1)),Be={class:"space-y-4"},De=g(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 脚本分类 ",-1)),je=g(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 脚本描述 ",-1)),Ie={class:"space-y-4"},Ne={class:"upload-content"},ze=g(()=>e("div",{class:"text-gray-600"},[e("p",{class:"text-lg mb-2"},"点击或拖拽多个JSON文件到此区域"),e("p",{class:"text-sm text-gray-500"}," 支持批量上传.json格式的脚本文件 ")],-1)),Me={key:0,class:"file-list"},Oe={class:"flex items-center justify-between"},Ue={class:"font-medium"},qe={class:"space-y-2 max-h-60 overflow-y-auto"},Je={class:"flex items-center"},$e={class:"text-sm font-medium"},Pe={class:"text-xs text-gray-500"},Re=g(()=>e("span",{class:"font-medium"},"批量设置",-1)),Ee=g(()=>e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," 统一分类 ",-1)),Te={key:1,class:"upload-progress"},We={class:"flex justify-end space-x-2"},Ae=re({name:"ScriptImportDialog",__name:"scriptImportDialog",props:{categories:{}},emits:["imported"],setup(C,{expose:K,emit:U}){const B=p(!1),x=p("single"),o=p(!1),r=p(null),w=p(""),k=p(""),c=p([]),S=p(""),F=p(0),L=()=>{q(),B.value=!0},q=()=>{r.value=null,w.value="",k.value="",c.value=[],S.value="",F.value=0,x.value="single"},Q=t=>t.name.endsWith(".json")?(r.value=t,!1):(f("请选择JSON格式的脚本文件",{type:"warning"}),!1),G=t=>{const n=t.filter(d=>d.name.endsWith(".json"));if(n.length===0){f("请选择JSON格式的脚本文件",{type:"warning"});return}c.value=n.map(d=>({file:d,status:"pending"}))},X=()=>{r.value=null},Y=t=>{c.value.splice(t,1)},Z=()=>{c.value=[]},J=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(2)+" KB":(t/(1024*1024)).toFixed(2)+" MB",ee=async()=>{if(!r.value){f("请选择要导入的脚本文件",{type:"warning"});return}const t=new FormData;t.append("file",r.value),w.value&&t.append("category",w.value),k.value&&t.append("description",k.value),await A({apiFunc:ce,apiParams:t,enableSucceedMsg:!0,succeedMsgContent:"脚本导入成功！",onBeforeRequest:()=>{o.value=!0},onSucceed:()=>{U("imported"),D()},onFailed:()=>{f("脚本导入失败",{type:"error"})},onCompleted:()=>{o.value=!1}})},le=async()=>{if(c.value.length===0){f("请选择要导入的脚本文件",{type:"warning"});return}const t=new FormData;c.value.forEach((n,d)=>{t.append("files",n.file)}),S.value&&t.append("category",S.value),await A({apiFunc:ue,apiParams:t,enableSucceedMsg:!0,succeedMsgContent:"批量导入完成！",onBeforeRequest:()=>{o.value=!0,F.value=0},onSucceed:n=>{const{success_count:d,total_count:j}=n;f(`成功导入 ${d}/${j} 个脚本`,{type:d>0?"success":"warning"}),U("imported"),D()},onFailed:()=>{f("批量导入失败",{type:"error"})},onCompleted:()=>{o.value=!1,F.value=100}})},D=()=>{B.value=!1,q()},ae=H(()=>r.value!==null),te=H(()=>c.value.length>0);return K({showDialog:L}),(t,n)=>{const d=u("el-icon"),j=u("el-upload"),b=u("el-button"),I=u("el-card"),$=u("el-option"),P=u("el-select"),se=u("el-input"),R=u("el-tab-pane"),oe=u("el-progress"),ne=u("el-tabs"),ie=u("el-dialog"),de=pe("loading");return i(),V(ie,{modelValue:B.value,"onUpdate:modelValue":n[4]||(n[4]=s=>B.value=s),title:"导入脚本",width:"800px",draggable:!0,onClose:D},{footer:l(()=>[e("div",We,[a(b,{onClick:D,disabled:o.value},{default:l(()=>[h(" 取消 ")]),_:1},8,["disabled"]),x.value==="single"?(i(),V(b,{key:0,type:"primary",icon:_(z),loading:o.value,disabled:!ae.value,onClick:ee},{default:l(()=>[h(v(o.value?"导入中...":"导入脚本"),1)]),_:1},8,["icon","loading","disabled"])):y("",!0),x.value==="batch"?(i(),V(b,{key:1,type:"primary",icon:_(z),loading:o.value,disabled:!te.value,onClick:le},{default:l(()=>[h(v(o.value?"导入中...":`批量导入 (${c.value.length})`),1)]),_:1},8,["icon","loading","disabled"])):y("",!0)])]),default:l(()=>[me((i(),m("div",ge,[a(ne,{modelValue:x.value,"onUpdate:modelValue":n[3]||(n[3]=s=>x.value=s),class:"import-tabs"},{default:l(()=>[a(R,{label:"单文件导入",name:"single"},{default:l(()=>[e("div",be,[a(j,{class:"upload-demo",drag:"","show-file-list":!1,"before-upload":Q,accept:".json",disabled:o.value},{default:l(()=>[e("div",he,[a(d,{class:"text-4xl text-gray-400 mb-4"},{default:l(()=>[a(_(z))]),_:1}),ye])]),_:1},8,["disabled"]),r.value?(i(),m("div",xe,[a(I,{shadow:"never",class:"border"},{default:l(()=>[e("div",we,[e("div",ke,[a(d,{class:"text-primary mr-2"},{default:l(()=>[a(_(T))]),_:1}),e("div",null,[e("div",Se,v(r.value.name),1),e("div",Fe,v(J(r.value.size)),1)])]),a(b,{size:"small",type:"danger",icon:_(W),onClick:X,disabled:o.value},{default:l(()=>[h(" 移除 ")]),_:1},8,["icon","disabled"])])]),_:1})])):y("",!0),r.value?(i(),m("div",Ve,[a(I,{shadow:"never",class:"border"},{header:l(()=>[Ce]),default:l(()=>[e("div",Be,[e("div",null,[De,a(P,{modelValue:w.value,"onUpdate:modelValue":n[0]||(n[0]=s=>w.value=s),placeholder:"请选择分类（可选）",style:{width:"100%"},clearable:"",disabled:o.value},{default:l(()=>[(i(!0),m(M,null,O(t.categories,s=>(i(),V($,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),e("div",null,[je,a(se,{modelValue:k.value,"onUpdate:modelValue":n[1]||(n[1]=s=>k.value=s),type:"textarea",rows:3,placeholder:"请输入脚本描述（可选）",disabled:o.value},null,8,["modelValue","disabled"])])])]),_:1})])):y("",!0)])]),_:1}),a(R,{label:"批量导入",name:"batch"},{default:l(()=>[e("div",Ie,[a(j,{class:"upload-demo",drag:"",multiple:"","show-file-list":!1,"on-change":(s,N)=>G(N.map(E=>E.raw)),accept:".json",disabled:o.value},{default:l(()=>[e("div",Ne,[a(d,{class:"text-4xl text-gray-400 mb-4"},{default:l(()=>[a(_(z))]),_:1}),ze])]),_:1},8,["on-change","disabled"]),c.value.length>0?(i(),m("div",Me,[a(I,{shadow:"never",class:"border"},{header:l(()=>[e("div",Oe,[e("span",Ue," 已选择 "+v(c.value.length)+" 个文件 ",1),a(b,{size:"small",type:"danger",onClick:Z,disabled:o.value},{default:l(()=>[h(" 清空列表 ")]),_:1},8,["disabled"])])]),default:l(()=>[e("div",qe,[(i(!0),m(M,null,O(c.value,(s,N)=>(i(),m("div",{key:N,class:"flex items-center justify-between p-2 bg-gray-50 rounded"},[e("div",Je,[a(d,{class:"text-primary mr-2"},{default:l(()=>[a(_(T))]),_:1}),e("div",null,[e("div",$e,v(s.file.name),1),e("div",Pe,v(J(s.file.size)),1)])]),a(b,{size:"small",type:"danger",icon:_(W),onClick:E=>Y(N),disabled:o.value},{default:l(()=>[h(" 移除 ")]),_:2},1032,["icon","onClick","disabled"])]))),128))])]),_:1}),a(I,{shadow:"never",class:"border"},{header:l(()=>[Re]),default:l(()=>[e("div",null,[Ee,a(P,{modelValue:S.value,"onUpdate:modelValue":n[2]||(n[2]=s=>S.value=s),placeholder:"为所有脚本设置统一分类（可选）",style:{width:"100%"},clearable:"",disabled:o.value},{default:l(()=>[(i(!0),m(M,null,O(t.categories,s=>(i(),V($,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]),_:1})])):y("",!0),o.value&&F.value>0?(i(),m("div",Te,[a(oe,{percentage:F.value,"stroke-width":8,status:"success"},null,8,["percentage"])])):y("",!0)])]),_:1})]),_:1},8,["modelValue"])])),[[de,o.value]])]),_:1},8,["modelValue"])}}});const Ge=fe(Ae,[["__scopeId","data-v-91be2146"]]);export{Ge as default};
