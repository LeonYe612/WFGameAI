import{b as c,a as n}from"./ocr-8f40b38a.js";import{s as l}from"./request-2aeceb02.js";import{r as i,aE as s,aG as h}from"./index-fbbdd03e.js";const v=()=>{const p=i([]),y=i([]),m=i([]),a=async()=>{try{return await c.list()}catch(r){s("获取代码库列表失败",{type:"error"}),console.error("fetchRepositories error:",r)}};return{repositories:p,tasks:y,results:m,fetchRepositories:a,addRepository:async(r,e)=>{try{await c.create({...e}),await a()}catch(o){console.error("createRepository error:",o)}},removeRepository:async(r,e)=>{try{await h.confirm("确定要删除这个代码库吗？","确认删除",{type:"warning"}),await c.delete(e),await a()}catch(o){o!=="cancel"&&console.error("deleteRepository error:",o)}},fetchTasks:async r=>{try{return await l({apiFunc:n.history,apiParams:{...r},enableSucceedMsg:!1})}catch(e){s("获取任务列表失败",{type:"error"}),console.error("fetchTasks error:",e)}},deleteTask:async r=>{try{await l({apiFunc:n.delete,apiParams:r,enableSucceedMsg:!0})}catch(e){s("删除任务失败",{type:"error"}),console.error("deleteTask error:",e)}},downloadTask:async r=>{try{const e=await n.download(r),o=window.URL.createObjectURL(new Blob([e.data])),t=document.createElement("a"),d=e.headers["content-disposition"].match(/filename=(.+)/),w=d?d[1]:"export.xlsx";t.href=o,t.setAttribute("download",w),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(o)}catch(e){s("下载出错, 请在console中查看错误详情!",{type:"error"}),console.error("downloadTask error:",e)}}}};export{v as useOcr};
