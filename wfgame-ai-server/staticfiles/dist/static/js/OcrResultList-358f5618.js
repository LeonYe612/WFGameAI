import{a as oe,o as ne}from"./ocr-1edae99a.js";import{g as U,A as se,B as re}from"./index-0964a6d0.js";import{s as A}from"./request-28f7529e.js";import ue from"./OcrResultCard-77964950.js";import{s as V,o as z,a as de}from"./enums-b2002ef1.js";import{m as ie,r as g,a0 as D,d as ce,w as pe,A as o,O as _e,j as r,k as _,z as a,I as t,x as d,F as y,p as v,u as f,l as P,y as I,B as w,P as me,R as fe,aP as ge,aZ as ye,_ as ve}from"./index-41f05ddf.js";const we={class:"flex-full flex-col"},he={class:"card-list-container","element-loading-text":"正在加载..."},ke={key:1,class:"card-grid"},xe={class:"pagination-wrapper"},be=ie({__name:"OcrResultList",props:{taskId:{}},setup(E){const h=E,k=g(!1),m=g([]),u=D({has_match:null,result_type:"",keyword:""}),i=D({currentPage:1,pageSize:24,total:0}),x=g(!1),O=g(null),R=g(0),T=ce(()=>m.value.map(n=>ye(n.image_path))),F=(n,e)=>{n.result_type=e},M=n=>{const e=m.value.findIndex(c=>c.id===n.id);e!==-1&&(R.value=e,x.value=!0)},p=async()=>{var n,e;if(h.taskId){k.value=!0;try{const c={id:h.taskId,page:i.currentPage,page_size:i.pageSize,...u},s=await A({apiFunc:oe.getDetails,apiParams:c});m.value=((n=s==null?void 0:s.data)==null?void 0:n.results)||[],i.total=((e=s==null?void 0:s.data)==null?void 0:e.total)||0}catch(c){ge.error("获取结果列表失败"),console.error(c)}finally{k.value=!1}}},b=()=>{i.currentPage=1,p()},N=()=>{u.has_match=null,u.result_type="",u.keyword="",b()},j=n=>{i.pageSize=n,i.currentPage=1,p()},q=n=>{i.currentPage=n,p()},Z=async n=>{const e=String(n);try{await A({apiFunc:ne.update,apiParams:{ids:m.value.reduce((c,s)=>(c[s.id]=e,c),{})},enableSucceedMsg:!0,succeedMsgContent:"批量标准成功"})}finally{p()}};return pe(()=>h.taskId,p,{immediate:!0}),(n,e)=>{const c=o("el-input"),s=o("el-form-item"),S=o("el-radio-button"),L=o("el-radio-group"),C=o("el-button"),$=o("el-icon"),G=o("el-dropdown-item"),H=o("el-dropdown-menu"),J=o("el-dropdown"),K=o("el-form"),B=o("el-card"),Q=o("el-image-viewer"),W=o("el-col"),X=o("el-row"),Y=o("el-empty"),ee=o("el-scrollbar"),te=o("el-pagination"),le=_e("loading");return r(),_("div",we,[a(B,{class:"filter-card"},{default:t(()=>[a(K,{model:u,inline:""},{default:t(()=>[a(s,{label:""},{default:t(()=>[a(c,{modelValue:u.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>u.keyword=l),placeholder:"输入关键字查找","prefix-icon":d(U),clearable:"",style:{width:"200px"},onChange:b},null,8,["modelValue","prefix-icon"])]),_:1}),a(s,{label:"结果类型"},{default:t(()=>[a(L,{modelValue:u.result_type,"onUpdate:modelValue":e[1]||(e[1]=l=>u.result_type=l),onChange:p},{default:t(()=>[(r(!0),_(y,null,v(d(V)(d(z)),l=>(r(),f(S,{key:l.value,label:l.value},{default:t(()=>[P("span",null,I(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"匹配状态"},{default:t(()=>[a(L,{modelValue:u.has_match,"onUpdate:modelValue":e[2]||(e[2]=l=>u.has_match=l),onChange:p},{default:t(()=>[(r(!0),_(y,null,v(d(V)(d(de)),l=>(r(),f(S,{key:l.value,label:l.value},{default:t(()=>[P("span",null,I(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,null,{default:t(()=>[a(C,{icon:d(U),type:"primary",onClick:b,plain:""},{default:t(()=>[...e[4]||(e[4]=[w(" 搜索 ",-1)])]),_:1},8,["icon"]),a(C,{icon:d(se),onClick:N},{default:t(()=>[...e[5]||(e[5]=[w(" 重置 ",-1)])]),_:1},8,["icon"])]),_:1}),a(s,null,{default:t(()=>[a(J,{onCommand:Z},{dropdown:t(()=>[a(H,null,{default:t(()=>[(r(!0),_(y,null,v(d(V)(d(z),[d(z).ALL]),l=>(r(),f(G,{key:l.value,command:l.value},{default:t(()=>[w(I(l.label),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:t(()=>[a(C,{type:"primary",plain:"",style:{width:"140px"}},{default:t(()=>[e[6]||(e[6]=w(" 当前页标注为 ",-1)),a($,null,{default:t(()=>[a(d(re),{class:"ml-1"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(B,{class:"table-card","body-style":"display: flex; flex-direction: column; flex: 1; overflow: hidden;"},{default:t(()=>[me((r(),_("div",he,[a(ee,null,{default:t(()=>[x.value?(r(),f(Q,{key:0,ref_key:"imageViewer",ref:O,"url-list":T.value,"show-progress":"","hide-on-click-modal":"","initial-index":R.value,onClose:e[3]||(e[3]=l=>x.value=!1)},null,8,["url-list","initial-index"])):fe("",!0),m.value.length>0?(r(),_("div",ke,[a(X,{gutter:16},{default:t(()=>[(r(!0),_(y,null,v(m.value,l=>(r(),f(W,{class:"mb-4",key:l.id,xs:24,sm:12,md:8,lg:6,xl:4},{default:t(()=>[a(ue,{result:l,"onUpdate:result_type":ae=>F(l,ae),onViewImage:M},null,8,["result","onUpdate:result_type"])]),_:2},1024))),128))]),_:1})])):(r(),f(Y,{key:2,description:"暂无数据"}))]),_:1})])),[[le,k.value]]),P("div",xe,[a(te,{"current-page":i.currentPage,"page-size":i.pageSize,total:i.total,"page-sizes":[24,36,48,60],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:q,background:""},null,8,["current-page","page-size","total"])])]),_:1})])}}});const Se=ve(be,[["__scopeId","data-v-2f93c50a"]]);export{Se as default};
