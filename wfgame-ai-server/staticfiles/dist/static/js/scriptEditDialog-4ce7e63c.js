import{d as V,n as I}from"./index-ccf167da.js";import{g as U,s as A}from"./scripts-d29b0ea0.js";import{s as D}from"./request-2aeceb02.js";import{m as G,r as u,A as c,O as K,j as i,u as L,I as l,l as t,z as o,B as f,y as p,x as w,P as $,k as d,R as v,aE as g,aG as H,_ as Q}from"./index-fbbdd03e.js";const W={class:"script-edit-content"},X={key:0,class:"space-y-4"},Y={class:"flex items-center justify-between"},Z={class:"flex items-center"},ee={class:"flex space-x-2"},te={class:"grid grid-cols-2 gap-4 text-sm mb-4"},se={class:"font-medium"},ae={key:0},le={key:1},oe={key:2},ne={class:"script-editor"},ie={class:"flex justify-between items-center mt-2 text-sm text-gray-500"},re={key:0,class:"text-orange-500"},de={key:1,class:"text-center py-12"},ue={class:"flex justify-end space-x-2"},ce=G({name:"ScriptEditDialog",__name:"scriptEditDialog",emits:["saved"],setup(pe,{expose:J,emit:O}){const h=O,y=u(!1),m=u(!1),r=u(!1),s=u(null),a=u(""),_=u(""),E=async n=>{s.value=n,a.value="",_.value="",y.value=!0,await z()},z=async()=>{s.value&&await D({apiFunc:U,apiParams:s.value.filename,onBeforeRequest:()=>{m.value=!0},onSucceed:n=>{a.value=n.content||"",_.value=n.content||""},onFailed:()=>{g("加载脚本内容失败",{type:"error"})},onCompleted:()=>{m.value=!1}})},F=()=>{try{const n=JSON.parse(a.value);a.value=JSON.stringify(n,null,2),g("JSON格式化成功",{type:"success"})}catch{g("JSON格式错误，无法格式化",{type:"error"})}},j=async()=>{if(s.value){try{JSON.parse(a.value)}catch{g("JSON格式错误，请检查语法",{type:"error"});return}await D({apiFunc:A,apiParams:[s.value.filename,a.value],enableSucceedMsg:!0,succeedMsgContent:"脚本保存成功！",onBeforeRequest:()=>{r.value=!0},onSucceed:()=>{_.value=a.value,h("saved"),x()},onFailed:()=>{g("脚本保存失败",{type:"error"})},onCompleted:()=>{r.value=!1}})}},x=()=>{y.value=!1,s.value=null,a.value="",_.value=""},b=()=>a.value!==_.value,k=()=>{b()?H.confirm("脚本内容已修改但未保存，确定要关闭吗？","确认关闭",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{x()}).catch(()=>{}):x()};return J({showDialog:E}),(n,e)=>{var B;const N=c("el-icon"),S=c("el-button"),R=c("el-tag"),q=c("el-input"),M=c("el-card"),P=c("el-dialog"),T=K("loading");return i(),L(P,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=C=>y.value=C),title:`编辑脚本 - ${((B=s.value)==null?void 0:B.filename)||""}`,width:"90%",draggable:!0,"before-close":k},{footer:l(()=>[t("div",ue,[o(S,{onClick:k,disabled:r.value},{default:l(()=>[...e[10]||(e[10]=[f(" 取消 ",-1)])]),_:1},8,["disabled"]),o(S,{type:"primary",icon:w(V),loading:r.value,onClick:j,disabled:!b()},{default:l(()=>[f(p(r.value?"保存中...":"保存脚本"),1)]),_:1},8,["icon","loading","disabled"])])]),default:l(()=>[$((i(),d("div",W,[!m.value&&s.value?(i(),d("div",X,[o(M,{shadow:"never",class:"border"},{header:l(()=>[t("div",Y,[t("div",Z,[o(N,{class:"mr-2"},{default:l(()=>[o(w(V))]),_:1}),e[2]||(e[2]=t("span",{class:"font-medium"},"脚本信息",-1))]),t("div",ee,[o(S,{size:"small",type:"info",onClick:F,disabled:r.value},{default:l(()=>[...e[3]||(e[3]=[f(" 格式化JSON ",-1)])]),_:1},8,["disabled"])])])]),default:l(()=>[t("div",te,[t("div",null,[e[4]||(e[4]=t("span",{class:"text-gray-500"},"文件名: ",-1)),t("span",se,p(s.value.filename),1)]),s.value.category?(i(),d("div",ae,[e[5]||(e[5]=t("span",{class:"text-gray-500"},"分类: ",-1)),o(R,{type:"info",size:"small"},{default:l(()=>[f(p(s.value.category),1)]),_:1})])):v("",!0),s.value.size?(i(),d("div",le,[e[6]||(e[6]=t("span",{class:"text-gray-500"},"文件大小: ",-1)),t("span",null,p((s.value.size/1024).toFixed(2))+" KB",1)])):v("",!0),s.value.modified_at?(i(),d("div",oe,[e[7]||(e[7]=t("span",{class:"text-gray-500"},"修改时间: ",-1)),t("span",null,p(new Date(s.value.modified_at).toLocaleString()),1)])):v("",!0)]),t("div",ne,[o(q,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=C=>a.value=C),type:"textarea",rows:20,placeholder:"请输入脚本内容（JSON格式）",class:"font-mono",disabled:r.value},null,8,["modelValue","disabled"])]),t("div",ie,[t("span",null,"字符数: "+p(a.value.length),1),b()?(i(),d("span",re,[...e[8]||(e[8]=[t("i",{class:"el-icon-warning-outline mr-1"},null,-1),f(" 内容已修改 ",-1)])])):v("",!0)])]),_:1})])):v("",!0),m.value?(i(),d("div",de,[o(N,{class:"animate-spin text-4xl text-primary mb-4"},{default:l(()=>[o(w(I))]),_:1}),e[9]||(e[9]=t("p",{class:"text-gray-500"},"正在加载脚本内容...",-1))])):v("",!0)])),[[T,m.value]])]),_:1},8,["modelValue","title"])}}});const ge=Q(ce,[["__scopeId","data-v-302bce5b"]]);export{ge as default};
