<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>项目监控测试 - WFGame AI</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h2><i class="fas fa-chart-line"></i> 项目监控功能测试</h2>
                <hr>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>API 测试结果</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults">
                            <p class="text-muted">点击下面的按钮开始测试...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>测试操作</h5>
                    </div>
                    <div class="card-body">
                        <button id="testProjectsBtn" class="btn btn-primary mb-2">测试获取项目列表</button><br>
                        <button id="testCreateProjectBtn" class="btn btn-success mb-2">测试创建项目</button><br>
                        <button id="openMonitorPageBtn" class="btn btn-info">打开项目监控页面</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>项目监控页面导航测试</h5>
                    </div>
                    <div class="card-body">
                        <p>测试从不同页面访问项目监控功能：</p>
                        <div class="btn-group" role="group">
                            <a href="/pages/index_template.html" class="btn btn-outline-primary">主页</a>
                            <a href="/pages/dashboard_template.html" class="btn btn-outline-primary">控制台</a>
                            <a href="/pages/devices.html" class="btn btn-outline-primary">设备管理</a>
                            <a href="/pages/project_monitor.html" class="btn btn-primary">项目监控</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let testResults = document.getElementById('testResults');

        // 显示测试结果
        function showResult(message, isError = false) {
            const alertClass = isError ? 'alert-danger' : 'alert-success';
            testResults.innerHTML += `<div class="alert ${alertClass}">${message}</div>`;
        }

        // 清空测试结果
        function clearResults() {
            testResults.innerHTML = '';
        }

        // 测试获取项目列表
        document.getElementById('testProjectsBtn').addEventListener('click', async function() {
            clearResults();
            showResult('正在测试获取项目列表...', false);

            try {
                const response = await fetch('/api/project-monitor/projects/list/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });

                const data = await response.json();

                if (data.success) {
                    showResult(`✓ 获取项目列表成功，共 ${data.projects.length} 个项目`, false);
                    if (data.projects.length > 0) {
                        showResult(`项目详情: ${JSON.stringify(data.projects, null, 2)}`, false);
                    }
                } else {
                    showResult(`✗ 获取项目列表失败: ${data.error}`, true);
                }
            } catch (error) {
                showResult(`✗ 网络错误: ${error.message}`, true);
            }
        });

        // 测试创建项目
        document.getElementById('testCreateProjectBtn').addEventListener('click', async function() {
            clearResults();
            showResult('正在测试创建项目...', false);

            const testProject = {
                name: `测试项目_${Date.now()}`,
                yaml_path: '/test/path/test.yaml',
                description: '这是一个测试项目'
            };

            try {
                const response = await fetch('/api/project-monitor/projects/create/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testProject)
                });

                const data = await response.json();

                if (data.success) {
                    showResult(`✓ 创建项目成功，项目ID: ${data.project.id}`, false);
                    showResult(`项目详情: ${JSON.stringify(data.project, null, 2)}`, false);
                } else {
                    showResult(`✗ 创建项目失败: ${data.error}`, true);
                }
            } catch (error) {
                showResult(`✗ 网络错误: ${error.message}`, true);
            }
        });

        // 打开项目监控页面
        document.getElementById('openMonitorPageBtn').addEventListener('click', function() {
            window.open('/pages/project_monitor.html', '_blank');
        });
    </script>
</body>
</html>
